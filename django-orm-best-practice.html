<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ—¿&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼&nbsp;|&nbsp;å¸ƒé²æ–¯ğŸŸçš„å¥‡æ€ä¹±æƒ³</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼">
  
    <meta name="description" content="å¹³æ—¶æ˜¯å°å¤©ä½¿ï¼Œå‡ºäº†é—®é¢˜å°±æ˜¯å¤§æ’’æ—¦">
    <meta property="og:description" content="å¹³æ—¶æ˜¯å°å¤©ä½¿ï¼Œå‡ºäº†é—®é¢˜å°±æ˜¯å¤§æ’’æ—¦">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ‘¹&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ—¿&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="0316b907039e49eb86c087e28a94f00b.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ§±&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>Projects</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3a9bcf6a-f4f8-4580-93a6-b21a38a8914b%2F988431636594419_.pic.jpg?table=block&amp;id=78f0b500-97be-4b05-ad6d-630418880655"></span>&nbsp;
          
          <span>å…³äº,å¸ƒé²æ–¯é±¼,a,https://github.com/IMBlues</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://images.unsplash.com/photo-1561411996-3794338f63cc?ixlib=rb-1.2.1&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb&amp;ixid=eyJhcHBfaWQiOjYzOTIxfQ">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ‘¹&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Fri, Nov 27, 2020</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/web.html">web</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/django.html">django</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--brown">
            <a href="tag/orm.html">orm</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/best-practice.html">best-practice</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/tech.html">tech</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/982e294cabb247aa878134d8bb6fd6ce" class="PageRoot"><div id="https://www.notion.so/65eb3916500142db8115b161d79ad878" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><ul id="https://www.notion.so/ae374395897843c3b06826ed14984083" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/6c1bbcd66e4d4e7782844ab050c1219b"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">é­”é¬¼çš„é™·é˜±</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c436ae0ebfb34819bc4fb3fbe9246a57"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">QuerySet</code></span><span class="SemanticString"> çš„ç±»å‹</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/120a19e13232487f96225b1ae3e82b96"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">æœ‰æ—¶å€™å¸Œæœ›å®ƒç®€å•ä¸€ç‚¹</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f603f2fbd0324a8499a73d36b96392f8"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">æœ‰æ—¶å€™å¸Œæœ›å®ƒåšæŒè‡ªæˆ‘</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6db8e2a3ed26424993cb9663b65027db"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">å¤šå¯¹å¤šå’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values()</code></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6c9af6e675e448fea225e5a014efe4e5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">ORM ç»ˆç©¶åªæ˜¯ ORM</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/701ba0fe21374e35bd159414d89b92b3"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">éšå¼è½¬æ¢</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d4c352263bb64a008bc81cba9941d68c"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">Mysql ä½ç‰ˆæœ¬æ—¶é—´ç²¾åº¦é—®é¢˜</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f618f11ceb5f4e6eb7cd69cc151f026b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">è™šå‡çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.query</code></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1ea4c6d533ef44b08d8364ea11a16bb8"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">å¤©ä½¿çš„çœ¼æ³ª</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/162617b046c941da99734d9bc18c8eca"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">å·§ç”¨ extra</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/acc07a2e8c4e425bb3a3f3a7f48cf0cc"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JsonField</code></span><span class="SemanticString"> çš„ç¦éŸ³â€”â€” </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSON_SEARCH</code></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4d5853a07d6d48a197c3cd1e428933a7"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">è¡Œé”çš„æ”¯æŒ</span></span></div></a></li></ul><div id="https://www.notion.so/1df92409ac024080b676fc7d3bdd70f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><blockquote id="https://www.notion.so/4a306f5ed2fc4f81bb023f2c5beaabfa" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">ä½œä¸ºä¸€åªä»¥ Django ä½œä¸ºä¸»åŠ›å¼€å‘æ¡†æ¶çš„ CRUD Boy ï¼Œæ—¶å¸¸å’Œå®ƒçš„ ORM ç¼ ç»µæ‚±æ»ã€çº ç¼ ä¸æ¸…ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹è¿™äº›ç¬‘ä¸æ³ªçš„è®°å¿†ã€‚</span></span></blockquote><h1 id="https://www.notion.so/6c1bbcd66e4d4e7782844ab050c1219b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/6c1bbcd66e4d4e7782844ab050c1219b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">é­”é¬¼çš„é™·é˜±</span></span></h1><h2 id="https://www.notion.so/c436ae0ebfb34819bc4fb3fbe9246a57" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c436ae0ebfb34819bc4fb3fbe9246a57"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">QuerySet</code></span><span class="SemanticString"> çš„ç±»å‹</span></span></h2><h3 id="https://www.notion.so/120a19e13232487f96225b1ae3e82b96" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/120a19e13232487f96225b1ae3e82b96"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">æœ‰æ—¶å€™å¸Œæœ›å®ƒç®€å•ä¸€ç‚¹</span></span></h3><div id="https://www.notion.so/e8e3441e58f64808a57217549b7d07ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">objects.values()</code></span><span class="SemanticString"> è¿”å›çš„å¹¶ä¸æ˜¯ç®€å•ç±»å‹çš„æ•°æ®ï¼Œè€Œæ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">QuerySet</code></span><span class="SemanticString">ã€‚ä¸€èˆ¬ç›´æ¥ç”¨æ¥åš </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Response</code></span><span class="SemanticString"> æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¦çŸ¥é“ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">QuerySet</code></span><span class="SemanticString"> æ˜¯ä¸èƒ½è¢« </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pickle</code></span><span class="SemanticString"> çš„ï¼Œå¦‚æœä½¿ç”¨åˆ° </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Django Cache</code></span><span class="SemanticString"> ä¹‹ç±»åŠŸèƒ½ï¼Œç›´æ¥ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values()</code></span><span class="SemanticString"> å½“ä½œè¿”å›ä¼šæ­»å¾—å¾ˆæƒ¨ã€‚</span></span></p></div><div id="https://www.notion.so/ff5f940839bc48d89ae016731aa9c6ed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/f603f2fbd0324a8499a73d36b96392f8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/f603f2fbd0324a8499a73d36b96392f8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">æœ‰æ—¶å€™å¸Œæœ›å®ƒåšæŒè‡ªæˆ‘</span></span></h3><div id="https://www.notion.so/0e3ffa2a8eab498da16d8858bc82861c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦é™åˆ¶ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">QuerySet</code></span><span class="SemanticString"> è¿”å›çš„å­—æ®µä»¥åŠ å¿« DB æŸ¥è¯¢çš„é€Ÿåº¦ï¼ˆæ¯”å¦‚ä¸€äº›æ²¡ç´¢å¼•çš„é•¿å­—æ®µ)ï¼Œè¿™æ—¶å€™å¯èƒ½çš„ä¸¤ä¸ªæ–¹æ³•ï¼š </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">only()</code></span><span class="SemanticString"> &amp; </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values()</code></span><span class="SemanticString"> ã€‚</span></span></p></div><div id="https://www.notion.so/1a76639d83a64d2581c940d2f6b2fcb7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä½†å®é™…æƒ…å†µæ˜¯ï¼Œä½¿ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values()</code></span><span class="SemanticString"> ä¼šæ”¹å˜ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queryset._iterable_class</code></span><span class="SemanticString"> ï¼Œå¦‚æœåé¢è¿˜æœ‰æ›´å¤šçš„çº§è”æŸ¥è¯¢ï¼Œä¼šå¯¼è‡´æœ€åçš„ç»“æœä¸º </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dict</code></span><span class="SemanticString"> è€Œä¸æ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">QuerySet</code></span><span class="SemanticString">ã€‚</span></span></p></div><div id="https://www.notion.so/df8188cbb2bc4446b33107f9dbff5f45" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/6db8e2a3ed26424993cb9663b65027db" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6db8e2a3ed26424993cb9663b65027db"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">å¤šå¯¹å¤šå’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values()</code></span></span></h2><div id="https://www.notion.so/2312ce96c5414a7abaa06aabeea7b424" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å­˜åœ¨ä¸€ä¸ªæ¨¡å‹</span></span></p></div><pre id="https://www.notion.so/516ac619647941459525fa359a8e25ce" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token operator">**</span>some_params<span class="token punctuation">)</span>
    bars <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token operator">**</span>some_params<span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/a594144a4bfa4a1299f9cd22b8cb05d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å­˜åœ¨ä¸€æ¡è®°å½•</span></span></p></div><pre id="https://www.notion.so/ce72c123401544e8ba02381db0d0a755" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>foo<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> tom
  bars<span class="token punctuation">:</span>
    <span class="token operator">-</span> a
    <span class="token operator">-</span> b </span></span></span></code></pre><div id="https://www.notion.so/7f8fd448c9c546f5990cd3cf99b47855" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values()</code></span><span class="SemanticString"> é¢„æœŸè¿”å›</span></span></p></div><pre id="https://www.notion.so/47d04002f0954b638a2fe2d0c273586c" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
        <span class="token property">"bars"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></span></span></span></code></pre><div id="https://www.notion.so/0d8a49efdc9a4ea8a01d3a66f92ef8ad" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å®é™…è¿”å›</span></span></p></div><pre id="https://www.notion.so/376ac1aaae6a490ba7f1c4293e6d3c6f" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
        <span class="token property">"bars"</span><span class="token operator">:</span> <span class="token string">"a"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
        <span class="token property">"bars"</span><span class="token operator">:</span> <span class="token string">"b"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></span></span></span></code></pre><div id="https://www.notion.so/2fa597b3038e4882834930f673a51010" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/3190438608db4193921b84728cfdef7c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ²¡æœ‰ä»€ä¹ˆå¤ªå¥½çš„è°ƒæ•´åŠæ³•ï¼Œåªèƒ½æ³¨æ„ + è§„é¿ï¼Œè¯¦è§: </span></span></p></div><div id="https://www.notion.so/ed9afc00e69747ce940cca0c9bc3ce0d" class="Bookmark"><a href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#values"><h5 class="Bookmark__Title">QuerySet API reference | Django documentation | Django</h5><p class="Bookmark__Desc">Django provides a range of refinement methods that modify either the types of results returned by the or the way its SQL query is executed. Returns a new containing objects that do not match the given lookup parameters. The lookup parameters () should be in the format described in Field lookups below.</p><p class="Bookmark__Link">https://docs.djangoproject.com/en/1.11/ref/models/querysets/#values</p></a></div><div id="https://www.notion.so/f26dd53e313f495986afa0be00dbaf06" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd55d79b9-fe83-43dd-8194-f02c9fea19d8%2FUntitled.png?width=873&amp;table=block&amp;id=f26dd53e-313f-4959-86af-a0be00dbaf06"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd55d79b9-fe83-43dd-8194-f02c9fea19d8%2FUntitled.png?width=873&amp;table=block&amp;id=f26dd53e-313f-4959-86af-a0be00dbaf06" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/26a0e17bdf144da9beb8c803ff731926" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/6c9af6e675e448fea225e5a014efe4e5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6c9af6e675e448fea225e5a014efe4e5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">ORM ç»ˆç©¶åªæ˜¯ ORM</span></span></h2><div id="https://www.notion.so/c4515a8083a442259f293ef3c0e3ab38" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/72e813d012b1403f8ec3cf7c158dd7c5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æˆ‘ä»¬è¦æ—¶åˆ»è®°ä½, </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">orm</code></span><span class="SemanticString"> åªæ˜¯åšä¸€ä¸ªæ˜ å°„ï¼Œæœ‰æ—¶å€™æ‹¿åˆ°çš„å¯¹è±¡å’Œæˆ‘ä»¬é¢„æƒ³å¹¶ä¸èƒ½å®Œå…¨ä¸€è‡´ã€‚</span></span></p></div><h3 id="https://www.notion.so/701ba0fe21374e35bd159414d89b92b3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/701ba0fe21374e35bd159414d89b92b3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">éšå¼è½¬æ¢</span></span></h3><pre id="https://www.notion.so/9fd7c1a9f5ce4591a7a8316455423263" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># è¿™é‡Œå…ˆå¿½ç•¥ timezone é—®é¢˜</span>
f1 <span class="token operator">=</span> Foo<span class="token punctuation">(</span>created<span class="token operator">=</span><span class="token string">'2020-09-18 09:46:23.544799'</span><span class="token punctuation">)</span>

<span class="token comment"># å­—ç¬¦ä¸²ä¼šè¢«å­˜å‚¨ï¼ŒDjango åšäº†éšå¼è½¬æ¢</span>
f1<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># str</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">)</span>

f2 <span class="token operator">=</span> Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>f1<span class="token punctuation">.</span>pk<span class="token punctuation">)</span>

<span class="token comment"># Datetime å¯¹è±¡ï¼</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/34abe9dc36824f97bf4b46f29816ac85" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/83a9e6e0d99f4295a673b051a47669dd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­å°±èƒ½çŸ¥é“ï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„å†…å­˜å¯¹è±¡ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">f1</code></span><span class="SemanticString"> å’Œé€šè¿‡ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">orm</code></span><span class="SemanticString"> æ‹¿å‡ºæ¥çš„å†…å­˜å¯¹è±¡ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">f2</code></span><span class="SemanticString"> å®Œå…¨ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œè™½ç„¶ä»–ä»¬éƒ½å¯ä»¥æ“ä½œåŒä¸€æ¡æ•°æ®åº“è®°å½•ï¼Œä½†å¦‚æœåœ¨å†…å­˜å¯¹è±¡é‡Œåšæ¯”è¾ƒå°±ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­</span></span></p></div><div id="https://www.notion.so/ba5976446ab84f75873643606d6035ca" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/d4c352263bb64a008bc81cba9941d68c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d4c352263bb64a008bc81cba9941d68c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Mysql ä½ç‰ˆæœ¬æ—¶é—´ç²¾åº¦é—®é¢˜</span></span></h3><pre id="https://www.notion.so/854866553124422aa2c6c9bd317148b8" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># å‡å®š Foo è¡¨ä¸­å·²ç»å­˜åœ¨äº†æ¯”è¾ƒå¤šçš„è®°å½•</span>
f <span class="token operator">=</span> Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># æˆ‘ä»¬é¢„æœŸæ˜¯è·å–æŒ‰ç…§æ—¶é—´æ¥æ’åºï¼Œf çš„å‰ä¸€æ¡è®°å½•</span>
o <span class="token operator">=</span> Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>created_lt<span class="token operator">=</span>f<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">.</span>latest<span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">)</span>

<span class="token keyword">assert</span> o<span class="token punctuation">.</span>pk <span class="token operator">==</span> f<span class="token punctuation">.</span>pk
<span class="token comment"># mysql ç‰ˆæœ¬å¤§äº 5.6.4 æ—¶ -> False</span>
<span class="token comment"># mysql ç‰ˆæœ¬å°äº 5.6.4 æ—¶ -> True</span></span></span></span></code></pre><div id="https://www.notion.so/c8504db620c64ef29ab169a63ea1320b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åŸå› å¾ˆç®€å•ï¼Œå½“ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">mysql</code></span><span class="SemanticString"> ç‰ˆæœ¬å°äº </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">5.6.4</code></span><span class="SemanticString"> æ—¶æ˜¯ä¸æ”¯æŒ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">microseconds</code></span><span class="SemanticString"> çš„ï¼Œç”±äºæˆ‘ä»¬çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">f</code></span><span class="SemanticString"> æ˜¯å†…å­˜å¯¹è±¡ï¼Œæ‹¿åˆ°çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">created</code></span><span class="SemanticString"> åˆæ˜¯æœ‰ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">microseconds</code></span><span class="SemanticString"> çš„ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">2020-09-18 09:24:38.260779</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">2020-09-18 09:24:38.000000</code></span><span class="SemanticString"> åšæ¯”è¾ƒï¼Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">o</code></span><span class="SemanticString"> ä¸€ç›´æ‹¿åˆ°çš„å°±æ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">f</code></span><span class="SemanticString"> å¯¹åº”çš„è®°å½•...</span></span></p></div><div id="https://www.notion.so/abb4542965884cd48b0704b7543b06c8" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F53b61d4b-0742-48a9-ac2c-54311236400f%2FUntitled.png?width=432&amp;table=block&amp;id=abb45429-6588-4cd4-8b07-04b7543b06c8"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F53b61d4b-0742-48a9-ac2c-54311236400f%2FUntitled.png?width=432&amp;table=block&amp;id=abb45429-6588-4cd4-8b07-04b7543b06c8" style="width:432px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e770841da5654cbeb6d4d6119198f395" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/f618f11ceb5f4e6eb7cd69cc151f026b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f618f11ceb5f4e6eb7cd69cc151f026b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">è™šå‡çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.query</code></span></span></h2><div id="https://www.notion.so/bcfcf9ae99414f86a116a21fbbd7fd0f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/a692a669d9554f9997df85f289c8ac84" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æˆ‘ä»¬å¸¸å¸¸ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queryset.query</code></span><span class="SemanticString"> å»æ£€æŸ¥å¤æ‚çš„æŸ¥è¯¢è¯­å¥ï¼Œä½†å®é™…ä¸Š </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">query</code></span><span class="SemanticString"> å±æ€§å¹¶ä¸èƒ½çœŸå®ååº”æäº¤åˆ° DB ä¸­çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sql</code></span><span class="SemanticString"> ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š</span></span></p></div><div id="https://www.notion.so/dadcf3b3611d47c09032bc3866edee31" class="Bookmark"><a href="https://code.djangoproject.com/ticket/17741"><h5 class="Bookmark__Title">QuerySet.query.__str__() does not generate valid MySQL query with dates</h5><p class="Bookmark__Desc">If you have a date parameter in a QuerySet, the string of the query is not valid SQL in MySQL and will generate a warning.</p><p class="Bookmark__Link">https://code.djangoproject.com/ticket/17741</p></a></div><div id="https://www.notion.so/f8033d2acf7a419ba31e4302c024ef6c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/f35f10b18b214aad8383e122260b182d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é‚£ä¹ˆå¦‚ä½•è°ƒè¯•æäº¤åˆ° DB ä¸­çš„å…·ä½“è¯­å¥å‘¢ï¼Ÿ</span></span></p></div><pre id="https://www.notion.so/dbb143ee8380465ea58773d6184445db" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> connection

<span class="token comment"># åœ¨è¯­å¥æäº¤ä¹‹åï¼Œç«‹å³æ‰“å°</span>
<span class="token comment"># åŒæ—¶éœ€è¦è®°å¾—å¼€å¯ DEBUG = True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>queries<span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/4039d41f0f2048bd8f362b2bf8074361" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å†æˆ–è€…ï¼Œç›´æ¥</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/650238/how-to-show-the-last-queries-executed-on-mysql">åœ¨ DB ä¸­å¼€å¯ general_log</a></span><span class="SemanticString"> ã€‚</span></span></p></div><div id="https://www.notion.so/4c22b1b15bf04ca9ab2d4d5749343835" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h1 id="https://www.notion.so/1ea4c6d533ef44b08d8364ea11a16bb8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/1ea4c6d533ef44b08d8364ea11a16bb8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">å¤©ä½¿çš„çœ¼æ³ª</span></span></h1><h2 id="https://www.notion.so/162617b046c941da99734d9bc18c8eca" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/162617b046c941da99734d9bc18c8eca"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">å·§ç”¨ extra</span></span></h2><div id="https://www.notion.so/f12494a7a8bc4c2588986d5052d0b457" class="Bookmark"><a href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#extra"><h5 class="Bookmark__Title">QuerySet API reference | Django documentation | Django</h5><p class="Bookmark__Desc">Django provides a range of refinement methods that modify either the types of results returned by the or the way its SQL query is executed. Returns a new containing objects that do not match the given lookup parameters. The lookup parameters () should be in the format described in Field lookups below.</p><p class="Bookmark__Link">https://docs.djangoproject.com/en/1.11/ref/models/querysets/#extra</p></a></div><div id="https://www.notion.so/403186d68af14bd49add2428bb10df36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/7005ffc717ee4130bc43297c3b2aafd5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">extra()</code></span><span class="SemanticString"> å¯ä»¥åˆ©ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sql</code></span><span class="SemanticString"> åœ¨æ•°æ®åº“ä¸­åšæ•°æ®å¤„ç†ï¼Œè€Œä¸ç”¨æ”¾åˆ°å†…å­˜ä¸­ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§æ—¶æœ‰æ¯”è¾ƒå¥½çš„æ•ˆæœï¼Œæ¯”å¦‚ï¼š</span></span></p></div><div id="https://www.notion.so/a3ed25e35d9b4c568e84ed89d614787d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><pre id="https://www.notion.so/4e74cfc4290f4cf3880b1ce716f2fd81" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>queryset <span class="token operator">=</span> queryset<span class="token punctuation">.</span>extra<span class="token punctuation">(</span>select<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">"CONCAT(username, '@', domain)"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/f51be0098d884db1a0b80443262781f4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/78702bc4168542bf8f1d77913cb25ac1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åœ¨æ¨¡ç³ŠæŸ¥è¯¢æ—¶ï¼ŒåŒ¹é…æœ€çŸ­ç»“æœ</span></span></p></div><pre id="https://www.notion.so/f75715e8c09c42b6af6305e5800e1622" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>MyModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>extra<span class="token punctuation">(</span>select<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'myfield_length'</span><span class="token punctuation">:</span><span class="token string">'Length(myfield)'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'myfield_length'</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/049161c443194efbbc90c78469ce4674" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/ebfff28f8890470eac3b1f29f03ed1c3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä½†åœ¨åŒæ—¶éœ€è¦æ ¼å¤–å°å¿ƒï¼Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">extra()</code></span><span class="SemanticString"> åœ¨å‚æ•°ä¸Šå­˜åœ¨æ³¨å…¥é£é™©ï¼Œæ‰€æœ‰å¯èƒ½çš„ç”¨æˆ·è¾“å…¥çš„ SQL æ‹¼æ¥ï¼Œéƒ½åº”è¯¥äº¤ç»™ Django å¤„ç†ã€‚</span></span></p></div><pre id="https://www.notion.so/9f2f462dece74c03aa643fe99cac1985" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># æœ‰æ³¨å…¥é£é™©, username ä¸ä¼šè¢«è½¬ä¹‰ï¼Œå¯ä»¥ç›´æ¥æ³¨å…¥</span>
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>extra<span class="token punctuation">(</span>where<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"headline='</span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">'"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># å®‰å…¨ï¼ŒDjango ä¼šå°† username å†…å®¹è½¬ä¹‰</span>
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>extra<span class="token punctuation">(</span>where<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'headline=%s'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">)</span></span></span></span></code></pre><h2 id="https://www.notion.so/acc07a2e8c4e425bb3a3f3a7f48cf0cc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/acc07a2e8c4e425bb3a3f3a7f48cf0cc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JsonField</code></span><span class="SemanticString"> çš„ç¦éŸ³â€”â€” </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSON_SEARCH</code></span></span></h2><div id="https://www.notion.so/dbdb29f2606748aab873230f4e581bb5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŠ¨æ€å­—æ®µï¼Œå¹¶ä¸”ä¿è¯åŠ¨æ€å­—æ®µçš„å€¼å…¨è¡¨å”¯ä¸€ã€‚åŠ¨æ€å­—æ®µæˆ‘ä»¬ä½¿ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LONGTEXT</code></span><span class="SemanticString"> å­˜å‚¨ï¼Œæ ¼å¼ä¸º </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">JSON</code></span><span class="SemanticString"> ã€‚å¦‚æœæ‰‹åŠ¨å¤„ç†ï¼Œéœ€è¦å°†æ•´ä¸ªè¡¨çš„å­—æ®µæ”¾åˆ°å†…å­˜ï¼Œå¹¶åšå”¯ä¸€æ ¡éªŒï¼Œéå¸¸éº»çƒ¦ä¸”è€—æ—¶ã€‚</span></span></p></div><div id="https://www.notion.so/1ab7b6b7335d42d9ad363862e1e044b8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ‰€ä»¥è¿˜æ˜¯ä¸€ä¸ªé“ç†ï¼ŒæŠŠè¿™ä¸ªé€»è¾‘äº¤ç»™ DB</span></span></p></div><pre id="https://www.notion.so/7c45139179054983b5efc9ceaa50b6f6" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> profiles_profile <span class="token keyword">where</span> JSON_SEARCH<span class="token punctuation">(</span>extras<span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/c16601909fca4a63ab73cb94f27d905b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/4d5853a07d6d48a197c3cd1e428933a7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4d5853a07d6d48a197c3cd1e428933a7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">è¡Œé”çš„æ”¯æŒ</span></span></h2><div id="https://www.notion.so/bce18671696b47df8fde1c582cccdd32" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¤šä¸ªæ“ä½œäº’æ–¥çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">select_for_update</code></span><span class="SemanticString"> è¡Œé”ä¿è¯æ­£ç¡®æ€§ã€‚</span></span></p></div><pre id="https://www.notion.so/7851b7be70b943b7a13068b159696e33" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ä»…åœ¨ transaction å†…ç”Ÿæ•ˆ</span>
    Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>select_for_update<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"Hello"</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/145c0edd05d4429a829ef581838006b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/5b48843a1a934ade8495125e2e246d07" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä½†æ˜¯åŒæ—¶éœ€è¦æ³¨æ„ï¼Œä¸Šé”çš„é¡ºåºï¼Œé¿å…äº§ç”Ÿæ­»é”ã€‚</span></span></p></div></article>
  <footer class="Footer">
  <div>&copy; å¸ƒé²æ–¯ğŸŸçš„å¥‡æ€ä¹±æƒ³ 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>