<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WV23EXEF9X"></script>
<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-WV23EXEF9X');
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F66ae2268-69fb-4a91-a4a8-fea3ba4543a5%2Fbluesyu.png?table=collection&amp;id=12c44699-617b-45ed-a019-c3b075e0ae01">

<style>
  :root {
    font-size: 20px;
  }
</style>

  <title>用 GraphQL 查询你的 Django 应用&nbsp;|&nbsp;布鲁斯鱼的奇思乱想 💭</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="用 GraphQL 查询你的 Django 应用">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😶‍🌫️&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F66ae2268-69fb-4a91-a4a8-fea3ba4543a5%2Fbluesyu.png?table=collection&amp;id=12c44699-617b-45ed-a019-c3b075e0ae01"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3a9bcf6a-f4f8-4580-93a6-b21a38a8914b%2F988431636594419_.pic.jpg?table=block&amp;id=78f0b500-97be-4b05-ad6d-630418880655"></span>&nbsp;
          
          <span>关于我</span>
        </div>
      </a>
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://images.unsplash.com/photo-1610007863631-86d870c56b45?ixlib=rb-1.2.1&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😶‍🌫️&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">用 GraphQL 查询你的 Django 应用</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sat, Nov 27, 2021</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/tech.html">tech</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/graphql.html">graphql</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/django.html">django</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/python.html">python</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/web.html">web</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/97932cef8ad549c497a56b31aebabc41" class="PageRoot PageRoot--FullWidth"><ul id="https://www.notion.so/070ac75dce344550b243c12c647168f2" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/ed167f6d7dc1485c99ccbed1637a1e3a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">什么是 GraphQL ？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/66e78933c6ae469e84618c0675fc3bcf"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">它有什么有意思的特性</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7b076e314f6c459c89f37a6b59eb284e"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Fragments</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a7ff55332c47410f80887ff5594150bf"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Directives</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/34abeca2000d4122a1507226c310451b"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">和 REST 相比较有什么优势和劣势？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/3ccbc71e18cf4a9d94d18a9ddfe5e513"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">TLDR</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d2f2475c9e9345c4879043b889e115e1"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">vs 扩展的 REST 协议</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/303f98eb35a3494ab4f091ba6ba1a165"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">什么是 GraphQL 客户端?</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8ef96bd3fd554061a128f36e795da9af"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">服务端落地：GraphQL → Django</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4e1a43ab5bd44c8f985261fe97511947"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">支持 Relay</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/bd6bbe6a62364ab7bd6851eb0dc25b27"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">引入 </span><span class="SemanticString">graphene-django-extras</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/19c10ac2c3b542d5a3623e4b5cba3e13"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">鉴权</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d2e3815b178d4af5b1fb06ed324a0333"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></div></a></li></ul><div id="https://www.notion.so/27559afdfe9c4a549c5285de70e8f090" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">😶‍🌫️</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">全文以后端开发视角写作，部分涉及到前端开发的介绍可能存在错误或者不准确，欢迎在评论区斧正</span></span></p></div><h2 id="https://www.notion.so/ed167f6d7dc1485c99ccbed1637a1e3a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ed167f6d7dc1485c99ccbed1637a1e3a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">什么是 GraphQL ？</span></span></h2><div id="https://www.notion.so/c7c3229e7a2840e2a1e2579a215c6e01" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">先来看看 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zh.wikipedia.org/wiki/GraphQL">wikipedia</a></span><span class="SemanticString">：</span></span></p></div><blockquote id="https://www.notion.so/a0a81e8ed9d641d6b5143f7a1af0adb8" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">GraphQL 是一个开源的，面向 API 而创造出来的数据查询操作语言以及相应的服务端运行环境。</span></span></blockquote><div id="https://www.notion.so/f99f4071591f48deba5c865e074ce17b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">GraphQL 首先是一种查询语言，它定义了一种通用的数据查询方式，可以理解为一种通用的 SQL，只不过前者面向抽象的数据集，后者往往是具体的关系型数据库。</span></span></p></div><div id="https://www.notion.so/c8a2518040054925aaa735c0ceb4fa6a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其次，它还包括一种服务端运行时，用于实现查询语句解析、数据类型定义。</span></span></p></div><h2 id="https://www.notion.so/66e78933c6ae469e84618c0675fc3bcf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/66e78933c6ae469e84618c0675fc3bcf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">它有什么有意思的特性</span></span></h2><div id="https://www.notion.so/62d1937fa9674bf49ab24e1c00782594" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">仅从后端开发视角，列举几个觉得有意思的特性</span></span></p></div><h3 id="https://www.notion.so/7b076e314f6c459c89f37a6b59eb284e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7b076e314f6c459c89f37a6b59eb284e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Fragments</span></span></h3><pre id="https://www.notion.so/f1496a5e2ca74b79a3277ca42410cc39" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">query</span> <span class="token definition-query function">HeroComparison</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">:</span> <span class="token scalar">Int</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token attr-name">leftComparison</span><span class="token punctuation">:</span> <span class="token property-query">hero</span><span class="token punctuation">(</span><span class="token attr-name">episode</span><span class="token punctuation">:</span> <span class="token constant">EMPIRE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">comparisonFields</span>
  <span class="token punctuation">}</span>
  <span class="token attr-name">rightComparison</span><span class="token punctuation">:</span> <span class="token property-query">hero</span><span class="token punctuation">(</span><span class="token attr-name">episode</span><span class="token punctuation">:</span> <span class="token constant">JEDI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">comparisonFields</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">comparisonFields</span> <span class="token keyword">on</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>
  <span class="token property-query">friendsConnection</span><span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token variable">$first</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">totalCount</span>
    <span class="token object">edges</span> <span class="token punctuation">{</span>
      <span class="token object">node</span> <span class="token punctuation">{</span>
        <span class="token property">name</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/17d38fee1ad6432780d3ac2f2d1e58d0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用 Fragment 复用查询内容，并且可以定义参数</span></span></p></div><h3 id="https://www.notion.so/a7ff55332c47410f80887ff5594150bf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a7ff55332c47410f80887ff5594150bf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Directives</span></span></h3><pre id="https://www.notion.so/7e4afa6489d04e7f832d0395e911fbf0" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">query</span> <span class="token definition-query function">Hero</span><span class="token punctuation">(</span><span class="token variable">$episode</span><span class="token punctuation">:</span> <span class="token class-name">Episode</span><span class="token punctuation">,</span> <span class="token variable">$withFriends</span><span class="token punctuation">:</span> <span class="token scalar">Boolean</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">hero</span><span class="token punctuation">(</span><span class="token attr-name">episode</span><span class="token punctuation">:</span> <span class="token variable">$episode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">name</span>
    <span class="token property">friends</span> <span class="token directive function">@include</span><span class="token punctuation">(</span><span class="token attr-name">if</span><span class="token punctuation">:</span> <span class="token variable">$withFriends</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token property">name</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># variables</span>
<span class="token punctuation">{</span>
  <span class="token string">"episode"</span><span class="token punctuation">:</span> <span class="token string">"JEDI"</span><span class="token punctuation">,</span>
  <span class="token string">"withFriends"</span><span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/3b4d9cd7b53c4277bc3fb83ab45ecd02" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以通过通用的两种指令来控制一些字段的返回：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/9df2b270c44a468db13fcc1c5315e87f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">@include(if: Boolean)</code></span><span class="SemanticString"> </span></span></li><li id="https://www.notion.so/4e73cec4c85d48aeb4985dc4084b1b7a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">@skip(if: Boolean)</code></span><span class="SemanticString"> </span></span></li></ul><h2 id="https://www.notion.so/34abeca2000d4122a1507226c310451b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/34abeca2000d4122a1507226c310451b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">和 REST 相比较有什么优势和劣势？</span></span></h2><h3 id="https://www.notion.so/3ccbc71e18cf4a9d94d18a9ddfe5e513" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3ccbc71e18cf4a9d94d18a9ddfe5e513"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TLDR</span></span></h3><div id="https://www.notion.so/4ab0ea839a73477293df68a09e7408a6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">REST 更多是从 HTTP 协议出发的一种约定协议，因为受制于 HTTP 协议本身的设计，在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">表达能力</strong></span><span class="SemanticString">上是弱于</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">作为查询语言</strong></span><span class="SemanticString">的 GraphQL 的。</span></span></p></div><div id="https://www.notion.so/2abe76de09ba40f0b17d2858b90ee00e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">同时，REST 通常都是由后端开发者主动封装，而 GraphQL 则是由前端主动拼装。</span></span></p></div><div id="https://www.notion.so/953219827c3b49f6b800cf111759e7b9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">所以如果面对的场景是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorGreen">前端需求复杂而多变，GraphQL 肯定比 REST 更适合快速迭代。</mark></span></span></p></div><div id="https://www.notion.so/3680ccd714f34ed3a2d96c9631e99e8b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">也正因此，GraphQL 在实现上更加繁复，所以</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorPink">面对 API 数量少、需求不会轻易的场景时，REST 反而是更适合的技术选型。</mark></span></span></p></div><div id="https://www.notion.so/be800f56e6384f89a575ac805a1d9131" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/7ebe44d40b0649d88bae9b91eaff2932" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">作为后端开发，学习和使用 GraphQL 的动力，更多是</em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">想将自己从 CRUD 的泥沼中拯救出来，</strong></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">将更多的精力放在其他更重要的技术上。</em></span></span></p></div><h3 id="https://www.notion.so/d2f2475c9e9345c4879043b889e115e1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d2f2475c9e9345c4879043b889e115e1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">vs 扩展的 REST 协议</span></span></h3><div id="https://www.notion.so/1da0f48f5d8844e081253c07567c4ff3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">（此小节中图片拷贝自</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.howtographql.com/basics/1-graphql-is-th">网络</a></span><span class="SemanticString">，懒得画）</span></span></p></div><div id="https://www.notion.so/07bd271af4bd42b3973ea1c1fb9d4b4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">和 REST 一样，GraphQL 并不是什么开发框架，它只是定义了一种通用型查询的 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/61810aa0782d48079d1869127a65cf71" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">而使用 REST 协议进行资源拉取，我们总是会面临一些实际的问题，而 GraphQL 可以在一定程度上解决。那么肯定会有同学在想，REST 是非常灵活的，完全可以通过自建一个查询语法，弥补上述的 REST 缺陷，何必要另外引入 GraphQL 徒增复杂度呢。</span></span></p></div><div id="https://www.notion.so/c5a2312b171440ab8ad4f1f8e8af8273" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">说的没错，所以我们在阐述这些问题的时候，也会附上我们当前基于 REST 的解决方案。</span></span></p></div><div id="https://www.notion.so/816c6a7983894493aaa55b6c114994b6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/02874aaecac84011b620226e22247ef7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Overfetching：</strong></span></span></p></div><div id="https://www.notion.so/2fdd7f1314b64990a97ee0fdc13c3e9d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">假如我们定义了一个 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/comments</code></span><span class="SemanticString"> 的 API，输出评论列表。以 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.django-rest-framework.org/">django-rest-framework</a></span><span class="SemanticString"> 为例，我们都会定义一个 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Serializer</code></span><span class="SemanticString"> 来声明它的输入和输出。</span></span></p></div><pre id="https://www.notion.so/5db71ee811f448c59aac2dd6e11f01eb" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers

<span class="token keyword">class</span> <span class="token class-name">CommentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    logo <span class="token operator">=</span> serializer<span class="token punctuation">.</span>ImageField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>省略数不清的字段<span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ip_from <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IPAddressField<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/ad82480c23e0424ab5754b3973c596ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">看起来符合常理，它可以轻松满足大多数评论列表的需求。但是也许某一天，我们需要一个评论的精简列表的 API，当前返回内容中，除了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">content</code></span><span class="SemanticString"> 以外的其他字段都变成多余了，那么后端开发需要重新定一个 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">MinimalCommentSerializer</code></span><span class="SemanticString"> 来满足新的需求。</span></span></p></div><div id="https://www.notion.so/22fe8cf128864a8c8aa92b38b12b91cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 REST 基础中，我们增加了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">fields</code></span><span class="SemanticString"> 参数，并在 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">DRF Serializer</code></span><span class="SemanticString"> 里做了</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/TencentBlueKing/bk-user/blob/8c633e0a3821beb839ed120c4514c5733e675862/src/api/bkuser_core/common/viewset.py#L71">特殊处理（你可以点击查看源码）</a></span><span class="SemanticString">，实现的具体效果：</span></span></p></div><pre id="https://www.notion.so/3835d9fd7c59451688ab1b85caea2e9b" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span># 查询 comment，并限制结果返回字段
/api/comments?fields=email<span class="token punctuation">,</span>content

# 返回
<span class="token punctuation">{</span>
  <span class="token property">"results"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"foo@bar.com"</span><span class="token punctuation">,</span>
      <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"I love this blog, simple and good looking."</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/74495885d6124f47a75394763d4a577e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">而如果我们使用 GraphQL，写法上会更自然：</span></span></p></div><pre id="https://www.notion.so/c02328bff5214137b9eb7c3c9897480a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token object">comment</span> <span class="token punctuation">{</span>
    <span class="token property">email</span>
    <span class="token property">content</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/f22f7f2c9c564265a8ee235621db8262" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Underfetching</strong></span></span></p></div><div id="https://www.notion.so/4a0f98e651ba477e915f44be70cd7c59" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">相较于 Overfetching 是获取了过多数据，Underfetching 则是在请求获取的数据不足够满足需求。</span></span></p></div><div id="https://www.notion.so/bd11a60a37ce4f22b9a684fc101dac1a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7396e0b5-7539-4174-992e-c35a8076984e%2FUntitled.png?width=720&amp;table=block&amp;id=bd11a60a-37ce-4f22-b9a6-84fc101dac1a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7396e0b5-7539-4174-992e-c35a8076984e%2FUntitled.png?width=720&amp;table=block&amp;id=bd11a60a-37ce-4f22-b9a6-84fc101dac1a" style="width:720px"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">传统的 REST 协议</span></span></figcaption></figure></div><div id="https://www.notion.so/f253ea5ef7c945598251ae1798d1d4d0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">假如我们需要获取所有用户维度的评论，我们需要先获取通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/users</code></span><span class="SemanticString"> 所有用户 id，再使用 id 列表遍历查询 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/users/&lt;id&gt;/comments</code></span><span class="SemanticString"> 来获取相关的列表。</span></span></p></div><div id="https://www.notion.so/3810914aa429435dbb27fafde0e014ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 REST 中，为了这个需求我们可能会额外为 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">/users</code></span><span class="SemanticString"> 增加一个参数 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">with_comments</code></span><span class="SemanticString"> </span></span></p></div><pre id="https://www.notion.so/03d8d2d5e4994c509bcd2ba28c0d6e11" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span># 查询 users，并限制结果返回字段
/api/users?with_comments=<span class="token number">1</span>

# 返回
<span class="token punctuation">{</span>
  <span class="token property">"results"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span>
      <span class="token property">"telephone"</span><span class="token operator">:</span> <span class="token string">"12345"</span><span class="token punctuation">,</span>
      <span class="token property">"comments"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"foo@bar.com"</span><span class="token punctuation">,</span>
          <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"I love this blog, simple and good looking."</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/5a3e4e1cb7604969be85834f95257ddb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/1b58acfe15704a639ad5488b952b574f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">相较于自定义的 REST 协议，使用 GraphQL 可以更简单：</span></span></p></div><div id="https://www.notion.so/3ce1d8c140624a2090437cc1420c1114" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc730795a-8b87-497e-a6c8-38c4c29f310a%2FUntitled.png?width=624&amp;table=block&amp;id=3ce1d8c1-4062-4a20-9043-7cc1420c1114"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc730795a-8b87-497e-a6c8-38c4c29f310a%2FUntitled.png?width=624&amp;table=block&amp;id=3ce1d8c1-4062-4a20-9043-7cc1420c1114" style="width:624px"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">使用 GraphQL，只需要一次请求</span></span></figcaption></figure></div><div id="https://www.notion.so/749cd37714ea4b4cb24413718f6e3080" class="Divider"></div><div id="https://www.notion.so/959ed72f15064b4398a8444974f83ea0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/75b7fe2a1f344d0c94b2a3afcb64d929" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">相信通过上面的例子，我们可以清晰地看出，相较于 GraphQL ，基于 REST 扩展协议存在这些问题：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/0167bc0cf8504f7d9fb54d47a45f1577" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">不够通用，用户有额外的学习成本，增加了额外的文档负担。</span></span></li><li id="https://www.notion.so/e0abfcd672544aba92086d0dc7db8369" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">基于 REST ，单个请求只能针对单个对象进行描述。需要等待需求沉淀，由后端主动封装，迭代节奏会更慢。</span></span></li></ul><h2 id="https://www.notion.so/303f98eb35a3494ab4f091ba6ba1a165" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/303f98eb35a3494ab4f091ba6ba1a165"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">什么是 GraphQL 客户端?</span></span></h2><div id="https://www.notion.so/ee868418d56c493687af6503408d1c54" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们主要聚焦于 GraphQL 服务端提供，但是也需要先看一下所谓的客户端究竟做了什么。</span></span></p></div><div id="https://www.notion.so/0653c1a83da44dd3b3aa9ffa7ae2d9d7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">简单来说，要想在原生 Javascript 中直接使用 GraphQL 并不是一件特别容易的事，需要一些库来协助拉取和管理 GraphQL 数据。</span></span></p></div><div id="https://www.notion.so/12d9b9f8a65d48e792d95313d4c64620" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">相较于原生的 GraphQL ，客户端主要解决了几件事情：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/81371edfcc6c4b8bbd802c1130de1a64" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">客户端数据拉取缓存问题（包括缓存一致性、更新缓存等）</span></span></li><li id="https://www.notion.so/007b09f969994ef4bff47e3a6edbd55f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">数据分页、声明式数据获取</span></span></li><li id="https://www.notion.so/4493363d5af84667bd50dde03d548e46" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">...</span></span></li></ul><div id="https://www.notion.so/7fdadf4748874b71923edbf3900341c0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">主流的客户端框架主要有两种—— </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://relay.dev/">Relay</a></span><span class="SemanticString"> 和 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.apollographql.com/">Apollo</a></span><span class="SemanticString"> ，我们仅从有限的角度来看下二者的异同：</span></span></p></div><div id="https://www.notion.so/02c95bba9d37409ca2c931458df7558c" class="CollectionInline"><h3><a class="Anchor" href="#https://www.notion.so/02c95bba9d37409ca2c931458df7558c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Relay vs Apollo </span></span></h3><div class="Table"><table><thead><tr><th style="width:232.66949462890625px"></th><th style="width:232.66949462890625px">Relay</th><th style="width:369.66949462890625px">Apollo</th></tr></thead><tbody><tr><td class="Table__CellTitle"><a href="https://www.notion.so/f72dde1d94214c778aa60e5a5c1e3592"><span class="SemanticStringArray"><span class="SemanticString">框架支持</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">仅支持 React, React Native</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">无框架限定</span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/bcc57ebb42ee4f4f906a0fc4318f77fa"><span class="SemanticStringArray"><span class="SemanticString">GraphQL API</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">需要特定的 Schema 支持</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">无需特定的 Schema 支持</span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/f96836caa663478dbdc6cc7fd1b6d1bf"><span class="SemanticStringArray"><span class="SemanticString">学习成本</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">较高</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">较低</span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/60fbd807b85845ac91d2fc0572cbb659"><span class="SemanticStringArray"><span class="SemanticString">生产力</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">高</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">较低</span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/9a35d9dee9024385a9df2ff98a38eda9"><span class="SemanticStringArray"><span class="SemanticString">灵活性</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">固定结构</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">较灵活</span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/0eab256b81eb4851b551ec99713141a3"><span class="SemanticStringArray"><span class="SemanticString">是否支持订阅</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">否</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">是</span></span></td></tr></tbody></table></div></div><div id="https://www.notion.so/0db1bccfd6384c49bfcc7ecadcd6f632" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">简而言之，Realy 更复杂，更能够应对大型应用，Apollo 更轻量，不过需要更多的手工劳动。</span></span></p></div><h2 id="https://www.notion.so/8ef96bd3fd554061a128f36e795da9af" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8ef96bd3fd554061a128f36e795da9af"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">服务端落地：GraphQL → Django</span></span></h2><div id="https://www.notion.so/913b630b47f2465ab5f72db1b4e89d4f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">想要将 GraphQL 引入现有的项目，我们需要安装两个基础的依赖：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/76ba0a08f79c4849ad91ebfe5d68ddfa" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/graphql-python/graphene-django">graphene-django</a></span><span class="SemanticString"> </span></span></li><li id="https://www.notion.so/a6bda339bbb04adaac5ddbd028085e0e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/carltongibson/django-filter">django-filter</a></span></span></li></ul><div id="https://www.notion.so/5021890f75eb4c74a5f935f78f813ae4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">二者分别负责两部分的工作：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/c275854c29364f7bb1863530b184d1d6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Django Model ⇒  Schema</span></span></li><li id="https://www.notion.so/adf3a33d3f484dc98d897cea8d8341dc" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Query  ⇒  Filter Django Model </span></span></li></ul><h3 id="https://www.notion.so/4e1a43ab5bd44c8f985261fe97511947" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4e1a43ab5bd44c8f985261fe97511947"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">支持 Relay</span></span></h3><div id="https://www.notion.so/718fb9ee6a8e40bd851e6a80c7dddad5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">graphene-django 本身 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.graphene-python.org/projects/django/en/latest/tutorial-relay/">默认支持 Relay</a></span><span class="SemanticString">，所以你可以很容易地开启</span></span></p></div><pre id="https://www.notion.so/381e63339ca34114bdc9754d939d17c2" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> graphene <span class="token keyword">import</span> relay
<span class="token keyword">from</span> graphene_django <span class="token keyword">import</span> DjangoObjectType
<span class="token keyword">from</span> ingredients<span class="token punctuation">.</span>models <span class="token keyword">import</span> Category

<span class="token comment"># Graphene will automatically map the Category model's fields onto the CategoryNode.</span>
<span class="token comment"># This is configured in the CategoryNode's Meta class (as you can see below)</span>
<span class="token keyword">class</span> <span class="token class-name">CategoryNode</span><span class="token punctuation">(</span>DjangoObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Category
        filter_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'ingredients'</span><span class="token punctuation">]</span>
        interfaces <span class="token operator">=</span> <span class="token punctuation">(</span>relay<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> <span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/b00040d904fe42f9be3ba70e91935826" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">不过很多时候考虑到 Relay 的复杂度，有时都不适合引入，更何况 Relay 需要特殊的 Schema 支持：</span></span></p></div><div id="https://www.notion.so/ed4e6fbf8f42439d95fff5e49684e816" class="ColumnList"><div id="https://www.notion.so/5340675cb13245289262f6cf428e64f8" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><pre id="https://www.notion.so/fdc74507478948fd9057663a97d7f8b2" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token object">allIngredients</span> <span class="token punctuation">{</span>
    <span class="token object">edges</span> <span class="token punctuation">{</span>
      <span class="token object">node</span> <span class="token punctuation">{</span>
        <span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token property">name</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre></div><div id="https://www.notion.so/c75ef76d87b246d8a068e00cc6b0c403" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><pre id="https://www.notion.so/d7d159927e7440d0a27a3a2552eaeb55" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token object">allIngredients</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



</span></span></span></code></pre></div></div><div id="https://www.notion.so/794cdaaa46074ae2bb00f8bd9ebbf28e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这时候 graphene-django 就存在一个问题，当不使用 Relay 时，存在一些功能缺失：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/82c4a6d43c4f4d4bb218f8054bedb333" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Fragment \ Directives </span></span></li><li id="https://www.notion.so/a1d1170d57e243c596c842cb3bc3794d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">分页、过滤</span></span></li><li id="https://www.notion.so/2ed3024db64d4cd6b7b4fd3dff761523" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">通过 DRF Serializer 定义 Mutations</span></span></li></ul><div id="https://www.notion.so/9af4cffa256b439896570ad34fc32ba6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">所以我们需要引入额外的库来解决。</span></span></p></div><h3 id="https://www.notion.so/bd6bbe6a62364ab7bd6851eb0dc25b27" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/bd6bbe6a62364ab7bd6851eb0dc25b27"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">引入 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/eamigo86/graphene-django-extras">graphene-django-extras</a></span></span></h3><pre id="https://www.notion.so/a57f6e1b98a440bfa1b829a5853cf31a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> graphene <span class="token keyword">import</span> ObjectType
<span class="token keyword">from</span> graphene_django_extras <span class="token keyword">import</span> DjangoListObjectField<span class="token punctuation">,</span> DjangoListObjectType
<span class="token keyword">from</span> graphene_django_extras<span class="token punctuation">.</span>paginations <span class="token keyword">import</span> LimitOffsetGraphqlPagination

<span class="token keyword">class</span> <span class="token class-name">CommentListType</span><span class="token punctuation">(</span>DjangoListObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Comment
        fields <span class="token operator">=</span> <span class="token string">"__all__"</span>
        pagination <span class="token operator">=</span> LimitOffsetGraphqlPagination<span class="token punctuation">(</span>default_limit<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> ordering<span class="token operator">=</span><span class="token string">"-id"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    comments <span class="token operator">=</span> DjangoListObjectField<span class="token punctuation">(</span>CommentListType<span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"Query all comments"</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/f119d7f59aab468f9c7d53d824b8b34d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">支持复杂过滤查询</strong></span></span></p></div><div id="https://www.notion.so/74be6f22ba9c4d03afb89191ae4d970c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以在列表对象中增加 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">filter_fields</code></span><span class="SemanticString"> ，针对不同的字段支持不同的 Django 复杂查询方法。</span></span></p></div><pre id="https://www.notion.so/b907e4d434cb4efdb0313d05489b9db1" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">CommentListType</span><span class="token punctuation">(</span>DjangoListObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Comment
        filter_fields <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"exact"</span><span class="token punctuation">,</span> <span class="token string">"in"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"exact"</span><span class="token punctuation">,</span> <span class="token string">"icontains"</span><span class="token punctuation">,</span> <span class="token string">"istartswith"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        pagination <span class="token operator">=</span> LimitOffsetGraphqlPagination<span class="token punctuation">(</span>default_limit<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> ordering<span class="token operator">=</span><span class="token string">"-username"</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/f3b6a1c087164a4284fbd319a1ff5422" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这样就可以将一些 Django 的查询能力释放到前端</span></span></p></div><pre id="https://www.notion.so/55bc40b107b14d2a9d9cce384a2cda1f" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token property-query">comments</span><span class="token punctuation">(</span><span class="token attr-name">id__In</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token attr-name">content_Icontains</span><span class="token punctuation">:</span> <span class="token string">"Amazing"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token property">totalCount</span>
    <span class="token property-query">results</span><span class="token punctuation">(</span><span class="token attr-name">limit</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token attr-name">offset</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token property">id</span>
      <span class="token property">email</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/c2b1ad63ba764eda9e8b209e41c54d94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">自定义查询字段</strong></span></span></p></div><div id="https://www.notion.so/15911f948d904e4aa96fb01a66e43896" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Django 默认的查询能力，对于一些特殊字段并不能完全覆盖需求，这时我们就需要针对这些内容手写一些处理逻辑。</span></span></p></div><pre id="https://www.notion.so/50f90962ddd64628a160410b5bf2db59" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> Field<span class="token punctuation">(</span>UserType<span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"Retrieve certain user"</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span>Int<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> username<span class="token operator">=</span>String<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">def</span> <span class="token function">resolve_user</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token string">"GraphQLResolveInfo"</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> User<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">id</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token builtin">id</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> username <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"username or pk at least one is required"</span><span class="token punctuation">)</span>

        <span class="token comment"># do some custom logic</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">return</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/e26841f9a0424f218f75b85893476cad" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">需要注意的是，当我们使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">resolve_</code></span><span class="SemanticString"> 函数去处理查询时，GraphQL 和 REST 本质上只是查询 DSL 有所区别，都会遇到类似像 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/97197/what-is-the-n1-selects-problem-in-orm-object-relational-mapping">N+1</a></span><span class="SemanticString"> 这样的慢查询问题，所以需要谨慎地将前端的查询转换成可靠的 Django ORM 查询。</span></span></p></div><h3 id="https://www.notion.so/19c10ac2c3b542d5a3623e4b5cba3e13" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/19c10ac2c3b542d5a3623e4b5cba3e13"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">鉴权</span></span></h3><div id="https://www.notion.so/b312c5b86ad6476a8f7d15db530e9a00" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于 API 请求并不再经过传统封装的 ViewSet，原有的鉴权组件不再能使用，你需要引入新的 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/redzej/graphene-permissions">graphene-permissions</a></span><span class="SemanticString"> 来解决针对用户的权限控制。</span></span></p></div><div id="https://www.notion.so/1aa5ae48117241808b187244a8178736" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">本文成文时，graphene-permissions 对于最新的 Graphene 3.x 有一些</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/redzej/graphene-permissions/pull/36">小的兼容性问题</a></span><span class="SemanticString">，由于该库代码量非常小，可以考虑复制到自己的项目手动维护。</span></span></p></div><pre id="https://www.notion.so/2ca857523607458d99de756db2559c1e" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> <span class="token punctuation">.</span>mixins <span class="token keyword">import</span> AuthNode
<span class="token keyword">from</span> <span class="token punctuation">.</span>permissions <span class="token keyword">import</span> AllowSuperuser

<span class="token keyword">class</span> <span class="token class-name">UserNode</span><span class="token punctuation">(</span>AuthNode<span class="token punctuation">,</span> DjangoObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>AllowAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        filter_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        interfaces <span class="token operator">=</span> <span class="token punctuation">(</span>relay<span class="token punctuation">.</span>Node<span class="token punctuation">,</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/1a98d82e656e4b33b14ae5085179f1df" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/552edd6e20494ff6b88831823dabb287" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">尴尬的是，如果你并不想用 Relay，我们需要针对 graphene-django-extras 做一些自己的定制，而原有的封装没有很好地暴露足够的接口，经过一番探索并无头绪，最终作罢🥴。</span></span></p></div><h2 id="https://www.notion.so/d2e3815b178d4af5b1fb06ed324a0333" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d2e3815b178d4af5b1fb06ed324a0333"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/8006978d3b3545b8b772c9b0e48d7370" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">GraphQL 在前端需求迭代频繁的场景下，比 REST 更符合现代开发节奏</span></span></li><li id="https://www.notion.so/822f102de1334e1da28a4a7fe89148ad" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">GraphQL 的语言设计比自定义扩展的 REST 更自然，更具备通用性</span></span></li><li id="https://www.notion.so/bcbebbb8c4094e608a21d67c5bc1db04" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">GraphQL 会将比较多的工作放到客户端，适合成熟的客户端开发团队，反之 REST 是更好的选择</span></span></li><li id="https://www.notion.so/6c2b3cc589d843ad94ad2816284fd0e9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Django 相关的生态建设并不完善，没有一个足够强大、开箱即用的整合方案</span></span></li><li id="https://www.notion.so/6765a5f9b9d14d5085e9cc9f4329a3e7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">由于查询并不是基于 Uri 维度，会给周边配套的生态—— 监控、日志等 ——带来一些新的挑战</span></span></li></ul><div id="https://www.notion.so/2a4c609ae22e40ce8622e7fad72fb07b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>

  <!-- utterances - Github issue comment -->
  <div>
    <script src="https://utteranc.es/client.js"
      repo="IMBlues/IMBlues.github.io"
      issue-term="pathname"
      label="blog-comment"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>
  </div>
  <!-- utterances - Github issue comment -->

  <footer class="Footer">
  <div>&copy; 布鲁斯鱼的奇思乱想 💭 2019-2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>

</body>

</html>
