<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WV23EXEF9X"></script>
<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-WV23EXEF9X');
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F66ae2268-69fb-4a91-a4a8-fea3ba4543a5%2Fbluesyu.png?table=collection&amp;id=12c44699-617b-45ed-a019-c3b075e0ae01">

<style>
  :root {
    font-size: 20px;
  }
</style>

  <title>Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼ II&nbsp;|&nbsp;å¸ƒé²æ–¯é±¼çš„å¥‡æ€ä¹±æƒ³ ğŸ’­</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼ II">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ‘¼&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F66ae2268-69fb-4a91-a4a8-fea3ba4543a5%2Fbluesyu.png?table=collection&amp;id=12c44699-617b-45ed-a019-c3b075e0ae01"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3a9bcf6a-f4f8-4580-93a6-b21a38a8914b%2F988431636594419_.pic.jpg?table=block&amp;id=78f0b500-97be-4b05-ad6d-630418880655"></span>&nbsp;
          
          <span>å…³äºæˆ‘</span>
        </div>
      </a>
    
  
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/images/page-cover/nasa_fingerprints_of_water_on_the_sand.jpg">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ‘¼&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼ II</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Fri, Sep 9, 2022</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/python.html">python</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/django.html">django</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--brown">
            <a href="tag/orm.html">orm</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/best-practice.html">best-practice</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/tech.html">tech</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/df2f83f3a8af4dc1b9a5bf5ead728813" class="PageRoot"><div id="https://www.notion.so/4a546d3d7c74496e9b1d7d1fb42c535d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æœ€è¿‘é‡æ“ CRUD æ—§ä¸šï¼Œåˆæœ‰ä¸€äº›æ–°çš„å‘ç°ï¼Œæ•…å¢åŠ ä¸€ç¯‡ </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="django-orm-best-practice.html">Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼</a></span><span class="SemanticString"> Part IIã€‚</span></span></p></div><h2 id="https://www.notion.so/82db9c2aeb01430195baee7397543088" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/82db9c2aeb01430195baee7397543088"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">åˆ©ç”¨ batch_size æ§åˆ¶æ•°æ®åº“å•æ¬¡æäº¤çš„å¤§å°</span></span></h2><div id="https://www.notion.so/b955dbbad6af4e4bbbf17f57011e519d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bulk_create</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bulk_update</code></span><span class="SemanticString"> æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ‰¹é‡åˆ›å»ºã€æ›´æ–°çš„æ–¹æ³•ï¼Œä½†æ‰¹é‡æé€Ÿä¸€æ—¶çˆ½ï¼Œæäº¤è¿‡é•¿ä¼šç›´æ¥å¯¼è‡´ä»»åŠ¡å¤±è´¥ã€‚</span></span></p></div><div id="https://www.notion.so/e46752e4dc8d4b0f82104152bcaf7bc5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¹‹å‰æ²¡æœ‰ç»†è‡´æŸ¥é˜…æ–‡æ¡£ï¼Œæƒ³å½“ç„¶ </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/TencentBlueKing/bk-user/blob/cd3d14b72d92de0cf687e9466a797b9fd07e0daf/src/api/bkuser_core/common/db_sync.py#L140">æ‰‹å†™äº†æ‰¹é‡æäº¤åˆ†ç‰‡çš„é€»è¾‘</a></span><span class="SemanticString"> ï¼Œè™½ç„¶ä¹Ÿå®Œå…¨å®ç°äº†åŠŸèƒ½ï¼Œä½†ç»ˆç©¶å¤šäº†ä¸€ä»½éœ€è¦ç»´æŠ¤çš„é€»è¾‘ï¼Œå®é™…ä¸Šç›´æ¥ç”¨ </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.djangoproject.com/zh-hans/4.1/ref/models/querysets/#bulk-create">Django é»˜è®¤æä¾›çš„ </a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.djangoproject.com/zh-hans/4.1/ref/models/querysets/#bulk-create"><code class="SemanticString__Fragment SemanticString__Fragment--Code">batch_size</code></a></span><span class="SemanticString"> å³å¯ã€‚</span></span></p></div><pre id="https://www.notion.so/3b93cd879b8949c7be5d71ab2141bd68" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> itertools <span class="token keyword">import</span> islice

batch_size <span class="token operator">=</span> <span class="token number">100</span>
objs <span class="token operator">=</span> <span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>headline<span class="token operator">=</span><span class="token string">'Test %s'</span> <span class="token operator">%</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    batch <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>islice<span class="token punctuation">(</span>objs<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> batch<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>batch<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span></span></span></span></code></pre><h2 id="https://www.notion.so/c1d8db45a5914bd3aeaf1fd0888cfbaf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c1d8db45a5914bd3aeaf1fd0888cfbaf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">é€šè¿‡ Prefetch æ§åˆ¶é¢„å–çš„æŸ¥è¯¢</span></span></h2><div id="https://www.notion.so/2f295609869e4562862dbe2af09eeb07" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/97197/what-is-the-n1-selects-problem-in-orm-object-relational-mapping">N + 1 é—®é¢˜</a></span><span class="SemanticString">æ˜¯éå¸¸å¸¸è§çš„æŸ¥è¯¢æ•ˆç‡æ€æ‰‹ã€‚åœ¨ Django ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">selected_related</code></span><span class="SemanticString"> æˆ–</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">prefetch_related</code></span><span class="SemanticString"> æ¥é¢„å–å…³è”å¯¹è±¡ï¼Œæ¥å‡å°‘å’Œ DB ä¹‹é—´çš„äº¤äº’ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šä¹Ÿéœ€è¦æœ‰ä¸€äº›æ³¨æ„çš„åœ°æ–¹ã€‚</span></span></p></div><div id="https://www.notion.so/bfa09ef62f6e4f979b47cbd47ecc450a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é¦–å…ˆï¼Œé¢„å–éœ€è¦ç²¾ç¡®æ§åˆ¶åˆ°å­—æ®µã€‚</span></span></p></div><div id="https://www.notion.so/a7ed80d360ec48b390053dc4545f72db" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Django é»˜è®¤çš„æŸ¥è¯¢æ–¹å¼éƒ½æ˜¯ç²—æ”¾çš„ï¼Œä¾‹å¦‚æ™®é€šæŸ¥è¯¢ä¸ä½¿ç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">values</code></span><span class="SemanticString"> æˆ–è€… </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">only</code></span><span class="SemanticString"> æ—¶éƒ½æ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">select *</code></span><span class="SemanticString"> ï¼Œè€Œé¢„å–ä¹Ÿä¸ä¾‹å¤–ï¼Œçœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</span></span></p></div><pre id="https://www.notion.so/8c41fb090be24c978d1670bff05edd5a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	foo <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Baz</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""A very large table"""</span>
	foo <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/af3472798e4b4d8db935e670a2bc0082" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æˆ‘ä»¬åœ¨æŸ¥è¯¢ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Foo</code></span><span class="SemanticString"> æ—¶ï¼Œä¼šå°è¯•é¢„å–å…³è”å­—æ®µä»¥åŠ é€Ÿåç»­æ•°æ®è¯»å–ï¼Œä½†å¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¸åŠ ä»»ä½•å‚æ•°ï¼š</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Foo.objects.all().prefetch_related()</code></span><span class="SemanticString"> ï¼Œ</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">é»˜è®¤åœ° Django ä¼šå°†æ‰€æœ‰å…³è”å­—æ®µéƒ½å–å‡ºæ¥</strong></span><span class="SemanticString">ï¼ŒåŠ å…¥ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Baz</code></span><span class="SemanticString"> è¡¨æ— æ¯”å·¨å¤§ï¼Œæœ¬æ¥ç”¨ä½œæ€§èƒ½ä¼˜åŒ–çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">prefetch_related</code></span><span class="SemanticString"> å°±ä¼šæ‘‡èº«å˜æˆè€—æ—¶æ€ªå…½ã€‚</span></span></p></div><div id="https://www.notion.so/994ff684a5bb45358ec9081b81474c2e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šé‡åˆ°çº§è”é¢„å–çš„åœºæ™¯ã€‚</span></span></p></div><pre id="https://www.notion.so/4b1e98488e284c1cafd9832a72ad4c7c" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	foo <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">"bars"</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Baz</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	bar <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Bar<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">"bazs"</span><span class="token punctuation">)</span>
	large_config <span class="token operator">=</span> models<span class="token punctuation">.</span>JSONField<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span></span></span></code></pre><div id="https://www.notion.so/a7a20e49425648d9a95c62c9e8f17838" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ­¤æ—¶åœ¨åç»­çš„å¾ªç¯å¤„ç†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Foo</code></span><span class="SemanticString"> å¯¹è±¡æŸ¥è¯¢åˆ° </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Baz</code></span><span class="SemanticString"> çš„æ•°æ®ï¼Œä¸ºäº†é¿å… N + 1 æˆ‘ä»¬ä¹Ÿä¼šå¤šçº§é¢„å–:</span></span></p></div><pre id="https://www.notion.so/43c1c48af79f485eaf6257421b46ee7a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">"bars"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prefetch_related<span class="token punctuation">(</span><span class="token string">"bars__bazs"</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/6ed989f8312342e2b14792e216500f48" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ­¤æ—¶äºŒçº§é¢„å–ä¹Ÿæ˜¯é»˜è®¤è·å–å…¨éƒ¨å­—æ®µï¼Œå€˜è‹¥ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Baz</code></span><span class="SemanticString"> è¡¨ä¸­æœ‰ä¸€ä¸ªéœ€è¦é¢å¤–è€—æ—¶åºåˆ—åŒ–çš„å­—æ®µï¼ŒåŒæ ·ä¼šä½¿ä¼˜åŒ–é€‚å¾—å…¶åã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘å¼•å…¥ </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.djangoproject.com/zh-hans/4.1/ref/models/querysets/#prefetch-objects"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Prefetch</code></a></span><span class="SemanticString"> å¯¹è±¡ï¼Œåšæ›´ç»†è‡´çš„æŸ¥è¯¢æ§åˆ¶ã€‚</span></span></p></div><pre id="https://www.notion.so/80535a8e9f1a4f9e928dd61ea5d16311" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Foo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">"bars"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>prefetch_related<span class="token punctuation">(</span>
	Prefetch<span class="token punctuation">(</span><span class="token string">"bars__bazs"</span><span class="token punctuation">,</span> queryset<span class="token operator">=</span>Baz<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>defer<span class="token punctuation">(</span><span class="token string">"large_config"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/ccd36cfe5f1348f5b9e31ca19eedeb10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/658dd384a7a9499e84984b784abf2102" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ˜¯ä¸æ˜¯è§‰å¾— ORM æŸ¥è¯¢æœ¬èº«ä¹ŸæŒºç¹æ‚çš„ï¼Ÿç”¨ SQL æœ‰æ—¶ä¼šæ›´ç›´æ¥æ¸…æ™°åœ°å¤šã€‚æ‰€ä»¥ä¹Ÿä¼šæœ‰ä¸€äº›å®Œå…¨</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://dev.solita.fi/2021/06/01/why-avoid-an-orm.html">ä¸ä½¿ç”¨ ORM çš„è§‚ç‚¹</a></span><span class="SemanticString">ã€‚åœ¨æˆ‘çœ‹æ¥ï¼ŒORM èƒ½è®© 90% çš„æŸ¥è¯¢éƒ½å˜å¾—ç»“æ„åŒ–æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤ã€ç”šè‡³æ›´å®‰å…¨ï¼Œä½†å‰©ä¸‹çš„ 10% ä¹Ÿè®¸ä¼šè€—è´¹æ›´å¤šçš„ç²¾åŠ›ï¼Œæ‰€ä»¥ä½•æ—¶ä½¿ç”¨ ORM æ˜¯æ ¹æ®å…·ä½“é¡¹ç›®åœºæ™¯æ¥å®šçš„ï¼Œä¸èƒ½å› å™åºŸé£Ÿã€‚</span></span></p></div><h2 id="https://www.notion.so/b8220e76aee241248794f0dde87fd8e3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b8220e76aee241248794f0dde87fd8e3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">å°å¹¿å‘Š</span></span></h2><div id="https://www.notion.so/95186dc7ed694d41a52a0af8aed1c8a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ˜¯ä¸æ˜¯è§‰å¾— Part II å†…å®¹æœ‰ç‚¹å°‘ï¼Ÿæ²¡å…³ç³»ï¼Œæ›´å¤šçš„å†…å®¹æˆ‘éƒ½æ”¾åœ¨äº†è¿™é‡Œã€‚</span></span></p></div><div id="https://www.notion.so/1b20568294cc493692016c2f5fae5683" class="Bookmark"><a href="https://github.com/TencentBlueKing/python-best-practices"><h5 class="Bookmark__Title">GitHub - TencentBlueKing/python-best-practices</h5><p class="Bookmark__Desc">Contribute to TencentBlueKing/python-best-practices development by creating an account on GitHub.</p><p class="Bookmark__Link">https://github.com/TencentBlueKing/python-best-practices</p></a></div><div id="https://www.notion.so/095acb088c8a44bba82fe37824e7be3b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æˆ‘å’Œå›¢é˜Ÿå°ä¼™ä¼´æ•´ç†äº†å¾ˆå¤š Python\Django\DRF çš„æœ€ä½³å®è·µç»éªŒï¼Œé¡¹ç›®ä¼šæŒç»­æ›´æ–°ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨ç»´æŠ¤ï¼Œå¸Œæœ›æ¯ä¸€ä¸ª CRUD ç”·å­©/å¥³å­©éƒ½èƒ½å°‘è¸©å‘ã€‚</span></span></p></div></article>

  <!-- utterances - Github issue comment -->
  <div>
    <script src="https://utteranc.es/client.js"
      repo="IMBlues/IMBlues.github.io"
      issue-term="pathname"
      label="blog-comment"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>
  </div>
  <!-- utterances - Github issue comment -->

  <footer class="Footer">
  <div>&copy; å¸ƒé²æ–¯é±¼çš„å¥‡æ€ä¹±æƒ³ ğŸ’­ 2019-2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>

</body>

</html>
