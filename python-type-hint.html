<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WV23EXEF9X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-WV23EXEF9X');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="让你的 Python 静态起来">
    <meta name="description" content="旧文重发">
  <meta property="og:description" content="旧文重发">
    <meta property="og:type" content="blog">
  <title>让你的 Python 静态起来</title>
  <!-- Favicon -->
    <link rel="shortcut icon" href="🗿">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span>🗿</span> <span>Home</span></div>
    </a>
                                            <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span>🎃</span> <span>About</span></div>
    </a>
                          </nav>
  <header class="Header">
          <div class="Header__Cover">
        <img src="https://pm1.narvii.com/6310/4ab2456aa8243f397d6e472e44b3b0cb4c211006_hq.jpg">
      </div>
          <div class="Header__Spacer ">
    </div>
        <div class="Header__Icon"><span>🐍</span></div>
        <h1 class="Header__Title">让你的 Python 静态起来</h1>
            <div class="DateTagBar">
                <span class="DateTagBar__Item DateTagBar__Date">Posted on Mon, Apr 1, 2019</span>
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/python.html">python</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/pep.html">pep</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/886dc6047e1f40558e77ee60cb2a5490" class="PageRoot"><ul id="https://www.notion.so/d3b854b858f94a1794d48ab17562caa3" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/261067ccb1f04703b454d0a013881ef8"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">为什么要 “静态”？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a783239622ac469e8ced9fd35a13e911"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Typing Annotation</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2793ea54dcaf4a068bfbcfa23a4a33d9"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">类型注释？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e0abf8660ba542fbabab1eafd9daf833"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Gradual typing</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ed849f5aa9404c7eacf575200d6fa2cd"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Types 和 Classes</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7d3f092498834b1bb608a76cb4ec0da1"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">各种使用场景</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/617371a96963422089e511ea4e2ffad4"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">基本类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/932e0ce23796434880f48db33a6ebb84"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">容器类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d72dd6e843a04fc4932b22571dd7fc3f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">类型别名</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5e799870b08b4880b9ea74546722b3c6"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">函数类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/917906c415f642bdbf04726d5fa4f954"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">“泛” 型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e7997c70ba334252bf13535b34b856b5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Any</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0a7c689597a84e34b87270a1835c718f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">TypeVar</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/72a9fc4f8b564fc791a1356bd9337d17"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">函数的“泛”型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2366d317f247463c9f4038f7086dc957"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Union 和 Optional</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/730a308c792c437ba2182bcda4c985a5"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Django model</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b57016456f5f49719fe2ae43370aeeb9"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Protocol</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7b1e1db854a54440969c43e94b895414"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">自定义类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c763b7ecaef44ea0921cd39146350a12"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">普通用法</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/26a1eca1ca884620924c228a2412f50c"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">类型自定义时</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4e570988d51e43dc875a8f3d7f08075f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">辅助函数</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a99bbbbb86e94cdb87664898d453316a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">typing-extensions</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e4dccbfc5d74429ab83140cc8467e8dd"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">实例：简化的枚举类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9a3db0c165c24a31b27b2b0b5b985911"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">工程技巧</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4eaadb55a430433d93192048d5f8746f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">避免循环引用</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8a151af822cd4ad8ae82945c50413685"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">mypy</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b8251b5de0ed4a009046014a4e0ccece"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">再让我们看看那个例子</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/bf161aa254614b2fb035dc1f83cef7b1"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">结语</span></span></div></a></li></ul><h2 id="https://www.notion.so/261067ccb1f04703b454d0a013881ef8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/261067ccb1f04703b454d0a013881ef8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">为什么要 “静态”？</span></span></h2><div id="https://www.notion.so/5a6486115d83484e8f54d172bfd51d46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在一切开始前，我们可以先看一个小例子:</span></span></p></div><pre id="https://www.notion.so/7eb91c6e440f40f281dd5b41fb960696" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">get_weapons_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	weapon_status <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"LeviathanAxe"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
		<span class="token string">"BladesofChaos"</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> weapon_status<span class="token punctuation">,</span>


weapons_status <span class="token operator">=</span> get_weapons_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> weapon<span class="token punctuation">,</span> status <span class="token keyword">in</span> weapons_status<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> status<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>weapon<span class="token punctuation">}</span></span><span class="token string"> is ready"</span></span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/d5a84a21f43c46208049ca115b0aba59" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在我们的预想里，上述代码应该会输出 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LeviathanAxe is ready</code></span><span class="SemanticString">，但实际运行则会报错：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">AttributeError: &#x27;tuple&#x27; object has no attribute &#x27;items&#x27;</code></span></span></p></div><div id="https://www.notion.so/1b9b18cce3aa4d02a3a54baf4e8a7a18" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">眼尖的同学肯定发现了，这段代码的问题是在 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">get_weapons_status</code></span><span class="SemanticString">的</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">return</code></span><span class="SemanticString"> 语句后多加了一个 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">,</code></span><span class="SemanticString">，所以函数的返回值并不是预期的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dict</code></span><span class="SemanticString"> 类型，而是 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">tuple</code></span><span class="SemanticString">。然而对于这样的写法，IDE 可能不会有明显提示，所以在我们做</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">大段的</strong></span><span class="SemanticString">代码重构或迁移时，它们很容易被忽略，直到运行时才会冒出来。</span></span></p></div><div id="https://www.notion.so/1612a75359d44068ac8bc870ca623fd8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们常把这类问题归结于自己的粗心大意，但是没有想过它们的“原罪”其实应该是 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Python 的动态</strong></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/08a1979a7aa74520a914bc7e27012bd3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">诚然，Python 的动态给我们带来了诸多酷炫的特性：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">monkey_patch</code></span><span class="SemanticString">、各种魔法方法、极为方便的 mock 测试.....但在逻辑分层设计、参数校验、代码补全时我们又无比渴望一些 “静态” 特性。</span></span></p></div><div id="https://www.notion.so/f2cd7ce30d5943f38bfc172a898ce57b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">所以，如果 Python 能够 “静态” 一些，将会给我们带来几个明显的增益：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7244b783b1f14b789c054688242b0b03" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">大幅度提升代码的可读性</span></span></li><li id="https://www.notion.so/cd5c8e5114f74b2db5c775c90f6d4ebd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">能够将参数传递时的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">类型错误</code></span><span class="SemanticString"> 扼杀在摇(biān)篮(mǎ)中</span></span></li><li id="https://www.notion.so/fd954fc13b8b4c108aaf2c7a485d4c1d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">能够最大程度利用 IDE 提供的代码提示，减少 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typo</code></span></span></li></ul><div id="https://www.notion.so/24454738650a425b95eda307fa051f1c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么该如何拥有这些“静态”的特性呢？下面我们将时间留给本文的主角——</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing annotaion</code></span><span class="SemanticString">。</span></span></p></div><h2 id="https://www.notion.so/a783239622ac469e8ced9fd35a13e911" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/a783239622ac469e8ced9fd35a13e911"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Typing Annotation</span></span></h2><div id="https://www.notion.so/5af962075f4746edaba01083432649a5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">从 Python 3.5 开始， </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">type annotation</code></span><span class="SemanticString"> 已经正式被引入了。</span></span></p></div><div id="https://www.notion.so/7c24d76d72544cccb54fb2e6f1a45156" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们可以对任何变量进行类型注解，无论是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">赋值之前</strong></span><span class="SemanticString">还是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">函数传参和返回</strong></span></span></p></div><pre id="https://www.notion.so/a244b6bae176458d98c582e6a35e6b52" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># 我们可以从类、模块、函数的 `__annotations__` 变量中获取这些注解</span>
nine_realms<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Niflheim"</span><span class="token punctuation">,</span> <span class="token string">"Muspelheim"</span><span class="token punctuation">,</span> <span class="token string">"Asgard"</span><span class="token punctuation">,</span> <span class="token string">"Midgard"</span><span class="token punctuation">,</span> <span class="token string">"Jotunheim"</span><span class="token punctuation">,</span> <span class="token string">"Vanaheim"</span><span class="token punctuation">,</span> <span class="token string">"Alfheim"</span><span class="token punctuation">,</span> <span class="token string">"Svartalfheim"</span><span class="token punctuation">,</span> <span class="token string">"Helheim"</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">Yggdrasill</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">transport</span><span class="token punctuation">(</span>realm<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
		<span class="token keyword">pass</span>
</span></span></span></code></pre><h3 id="https://www.notion.so/2793ea54dcaf4a068bfbcfa23a4a33d9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2793ea54dcaf4a068bfbcfa23a4a33d9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">类型注释？</span></span></h3><div id="https://www.notion.so/175b483d97a34871882eaea5ae1e1e82" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">除了“注解”，我们也可以使用类型注释</span></span></p></div><pre id="https://www.notion.so/07b8dd1884924ef6af34ddfccd5f5378" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pi <span class="token operator">=</span> <span class="token number">3.142</span> <span class="token comment"># type: float</span></span></span></span></code></pre><div id="https://www.notion.so/07aa17143d16490992c583cd40cdb222" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">相较于“注解”，注释对代码的侵入性更小，但同时可读性更差，只适用于不支持注解的场景。官方推荐使用类型注解，所以类型注释的内容就不再展开了。</span></span></p></div><h3 id="https://www.notion.so/e0abf8660ba542fbabab1eafd9daf833" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e0abf8660ba542fbabab1eafd9daf833"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Gradual typing</span></span></h3><div id="https://www.notion.so/685c11055bd44a91ada2718e188feb22" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">类型注解只会生存于“编码时”，并不影响运行时，我们可以放心大胆地为旧代码添加注解，而不用担心对实际功能产生影响。当然对于大型项目（只要注解本身不写错），我们可以采取“渐进式注解”，对一些关键的核心模块先进行改造，详见 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0483/#summary-of-gradual-typing">gradual typing</a></span></span></p></div><h3 id="https://www.notion.so/ed849f5aa9404c7eacf575200d6fa2cd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ed849f5aa9404c7eacf575200d6fa2cd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Types 和 Classes</span></span></h3><div id="https://www.notion.so/9a58054f55f6492789a6ab3bae786a5e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">需要额外说明的是，在类型注解中，我们经常会使用 “类(class)” 和 “类型(type)” 做注解：</span></span></p></div><pre id="https://www.notion.so/c8446f9b48174de7b4da55e9859f173a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"Atreus"</span>

<span class="token keyword">from</span> typing <span class="token keyword">import</span> List
names<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Atreus"</span><span class="token punctuation">,</span> <span class="token string">"Loki"</span><span class="token punctuation">]</span></span></span></span></code></pre><div id="https://www.notion.so/747b94d88a444fe9847bbe1269f36511" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其中 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">str</code></span><span class="SemanticString"> 既是一种 “类”，同时也是一种 “类型”，而 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">List</code></span><span class="SemanticString"> 只是一种 “类型”，我们是不能够在 “运行时” 使用它们的，例如：</span></span></p></div><pre id="https://www.notion.so/bb90b54fd2d346129affa477127537ba" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Names</span><span class="token punctuation">(</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># raises TypeError</span></span></span></span></code></pre><div id="https://www.notion.so/2f92f3abb6744938a9350c2508677ac9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">简单来说，任何一种 “类” 都可以被当作一种 ”类型“，反过来 ”类型” 却不一定能被当作 “类” 使用。</span></span></p></div><h2 id="https://www.notion.so/7d3f092498834b1bb608a76cb4ec0da1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7d3f092498834b1bb608a76cb4ec0da1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">各种使用场景</span></span></h2><div id="https://www.notion.so/679b969ede7544b38fc1f56d3cc459ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">下面我们主要将常用的类型注解结合工程场景举例</span></span></p></div><h3 id="https://www.notion.so/617371a96963422089e511ea4e2ffad4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/617371a96963422089e511ea4e2ffad4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">基本类型</span></span></h3><pre id="https://www.notion.so/7b04effd689e4616a11c544630793a07" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">hey_boy</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token string">'Boy: '</span> <span class="token operator">+</span> name</span></span></span></code></pre><div id="https://www.notion.so/e58a2ab53f5b4c37884ccd84b1a48dea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">正如上面提到，任何基本类型都可以直接当做注解使用，包括但不限于：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">int</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">str</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">list</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dict</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">set</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">None</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bool</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">tuple</code></span><span class="SemanticString">等等，</span></span></p></div><h3 id="https://www.notion.so/932e0ce23796434880f48db33a6ebb84" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/932e0ce23796434880f48db33a6ebb84"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">容器类型</span></span></h3><pre id="https://www.notion.so/25ae8c4b0610434f9c917b9e27c19228" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token comment"># 纯容器</span>
<span class="token keyword">def</span> <span class="token function">print_names</span><span class="token punctuation">(</span>names<span class="token punctuation">:</span> List<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token comment"># 容器 &amp; 容器内元素</span>
<span class="token keyword">def</span> <span class="token function">print_names</span><span class="token punctuation">(</span>names<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

print_names<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Kratos'</span><span class="token punctuation">,</span> <span class="token string">'Thor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
print_names<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'any_type'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 不被允许，容器内元素类型不一致</span>

<span class="token keyword">def</span> <span class="token function">print_names</span><span class="token punctuation">(</span>names<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

print_names<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'Blues'</span><span class="token punctuation">:</span> <span class="token string">'Yu'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/d72dd6e843a04fc4932b22571dd7fc3f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d72dd6e843a04fc4932b22571dd7fc3f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">类型别名</span></span></h3><div id="https://www.notion.so/e69861cffebb4ce08c27fa1747e55a0a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">容器内元素会非常复杂，我们可能会有类似 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dict[str, Dict[str: SomeObject]]</code></span><span class="SemanticString"> 这种不容易阅读的写法，此时我们也可以用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">类型别名</code></span><span class="SemanticString">来简化。</span></span></p></div><pre id="https://www.notion.so/21a67eb907e44e3cb32302726a173f97" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict

Point <span class="token operator">=</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">:</span> SomeObject<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">print_points</span><span class="token punctuation">(</span>points<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Point<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> point <span class="token keyword">in</span> points<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"X:"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" Y:"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/5e799870b08b4880b9ea74546722b3c6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5e799870b08b4880b9ea74546722b3c6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">函数类型</span></span></h3><div id="https://www.notion.so/5ac891fef7fa4e7ea789c8233bc95751" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在类似装饰器、回调等场景下，我们需要对函数参数作注解，基本的格式为：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Callable[[Arg1Type, Arg2Type], ReturnType]</code></span><span class="SemanticString">。其中 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">[Arg1Type, Arg2Type]</code></span><span class="SemanticString"> 是输入参数列表，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ReturnType</code></span><span class="SemanticString"> 是返回内容。</span></span></p></div><pre id="https://www.notion.so/7a59c89dd6494b1d8bcd64b04a5eac60" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Callable

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>func<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span> argument<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>func<span class="token punctuation">(</span>argument<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span>

foo<span class="token punctuation">(</span>create_greeting<span class="token punctuation">,</span> <span class="token string">"Jekyll"</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/917906c415f642bdbf04726d5fa4f954" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/917906c415f642bdbf04726d5fa4f954"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">“泛” 型</span></span></h3><h3 id="https://www.notion.so/e7997c70ba334252bf13535b34b856b5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e7997c70ba334252bf13535b34b856b5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Any</span></span></h3><div id="https://www.notion.so/67c1377a32fc43bb8abc8596e948235b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有时候我们对于某些“泛”型变量，我们可以用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Any</code></span><span class="SemanticString"> 来表明</span></span></p></div><pre id="https://www.notion.so/bd47d82645b04638bc172ee981f67e0d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> AnyStr<span class="token punctuation">,</span> Any

<span class="token comment"># 任意类型</span>
<span class="token comment"># Any 兼容任意类型</span>
<span class="token keyword">def</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> Any<span class="token punctuation">,</span> b<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Any<span class="token punctuation">:</span>
	<span class="token keyword">pass</span></span></span></span></code></pre><h3 id="https://www.notion.so/0a7c689597a84e34b87270a1835c718f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0a7c689597a84e34b87270a1835c718f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TypeVar</span></span></h3><div id="https://www.notion.so/10537107eedf4a88955191ee16ebca7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span><span class="SemanticString"> 表示 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Type</code></span><span class="SemanticString"> 类型。简单来说，她就是“类型”的“类型”。和 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">type</code></span><span class="SemanticString"> 可以创造 “类” 一样，我们可以通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span><span class="SemanticString"> 来创造 “类型”。</span></span></p></div><div id="https://www.notion.so/cf050d7824e445dba7906ff737100f75" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">例如 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing</code></span><span class="SemanticString"> 中提供的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">AnyStr</code></span><span class="SemanticString"> 其实就是通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar(&#x27;AnyStr&#x27;, Text, bytes)</code></span><span class="SemanticString"> 来表示的。</span></span></p></div><pre id="https://www.notion.so/8a55bc5b60244c2c933352c87f3e9454" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># 任意字符型</span>
<span class="token comment"># AnyStr = TypeVar('AnyStr', Text, bytes)</span>

<span class="token keyword">def</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> AnyStr<span class="token punctuation">,</span> b<span class="token punctuation">:</span> AnyStr<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> AnyStr<span class="token punctuation">:</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b

concat<span class="token punctuation">(</span><span class="token string">u"foo"</span><span class="token punctuation">,</span> <span class="token string">u"bar"</span><span class="token punctuation">)</span> 
concat<span class="token punctuation">(</span><span class="token string">b"foo"</span><span class="token punctuation">,</span> <span class="token string">b"bar"</span><span class="token punctuation">)</span> 
concat<span class="token punctuation">(</span><span class="token string">u"foo"</span><span class="token punctuation">,</span> <span class="token string">b"bar"</span><span class="token punctuation">)</span>

<span class="token comment"># 以上三种写法都会被类型检查接受，但是运行时，最后一种调用会报错 `TypeError: can't concat str to bytes`</span></span></span></span></code></pre><h3 id="https://www.notion.so/72a9fc4f8b564fc791a1356bd9337d17" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/72a9fc4f8b564fc791a1356bd9337d17"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">函数的“泛”型</span></span></h3><div id="https://www.notion.so/1d4c71879e874918ac87c810ab1a8b94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有时候，函数可能需要支持多种类型输入输出，我们可以通过多种方法来实现注解。</span></span></p></div><div id="https://www.notion.so/1dd084894b9d4ef6b36f0937a11e4135" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing.overload</code></span></span></p></div><pre id="https://www.notion.so/5ef373b1982c4334905e0cee28cde33a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> overload<span class="token punctuation">,</span> List


<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>developers<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>developers<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


<span class="token comment"># 这里不能有类型注解，并且需要实现一个通用的做法</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>developers<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 "ponyma,jackma,allenzhang"</span>
		developers <span class="token operator">=</span> developers<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers
	<span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> List<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 ["ponyma", "jackma", "allenzhang"]</span>
		developers <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>developers<span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers</span></span></span></code></pre><div id="https://www.notion.so/6f48e43eb472478e913b4bdf6e971768" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Union[Type1, Type2]</code></span></span></p></div><pre id="https://www.notion.so/acbb62fc9ce34d389d9c1377fd4190c9" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Union[X, Y] 意味着是 X 或 Y 类型</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> List<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 "ponyma,jackma,allenzhang"</span>
		developers <span class="token operator">=</span> developers<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers
	<span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> List<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 ["ponyma", "jackma", "allenzhang"]</span>
		developers <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>developers<span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers</span></span></span></code></pre><h3 id="https://www.notion.so/2366d317f247463c9f4038f7086dc957" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2366d317f247463c9f4038f7086dc957"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Union 和 Optional</span></span></h3><pre id="https://www.notion.so/14bcab88614d480ea57f4f345d3322f1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union

<span class="token comment"># 通常的 Union 用法</span>
<span class="token keyword">def</span> <span class="token function">print_grade</span><span class="token punctuation">(</span>grade<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>grade<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>grade <span class="token operator">+</span> <span class="token string">' percent'</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' percent'</span><span class="token punctuation">)</span>

<span class="token comment"># Optional[X] 相当于 Union[X, None]</span>
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>optional_info<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> optional_info <span class="token keyword">or</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span></span></span></code></pre><h3 id="https://www.notion.so/730a308c792c437ba2182bcda4c985a5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/730a308c792c437ba2182bcda4c985a5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Django model</span></span></h3><pre id="https://www.notion.so/25a0a817e8c048178d4320ebaeed22ff" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union<span class="token punctuation">,</span> List
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> QuerySet
<span class="token keyword">from</span> my_app<span class="token punctuation">.</span>models <span class="token keyword">import</span> MyModel

<span class="token comment"># 在后续代码中，records 的类型将被等同于 MyModel 的 QuerySet</span>
<span class="token comment"># 不过同时需要注意，如果此时传入一个单纯的 List[MyModel]，</span>
<span class="token comment"># 并调用 QuerySet 的方法，静态检查是不会探测出问题的</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>records<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>QuerySet<span class="token punctuation">,</span> List<span class="token punctuation">[</span>MyModel<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span></span></span></span></code></pre><h3 id="https://www.notion.so/b57016456f5f49719fe2ae43370aeeb9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b57016456f5f49719fe2ae43370aeeb9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Protocol</span></span></h3><div id="https://www.notion.so/92d13c82c85c4978b22a81a77c1ecc1e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">协议类型是一个特殊的结构化类型，它表示一种静态的鸭子类型，有点像是 Go 中的接口定义，但依旧只存在于“编码时”。</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Protocol</code></span><span class="SemanticString"> 的好处是，我们可以很明确的定义和使用鸭子类型，而不用人工核对方法的输入输出。</span></span></p></div><div id="https://www.notion.so/637d894e649f4bcea0365e070bc17c6d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">举个例子：</span></span></p></div><pre id="https://www.notion.so/cd3a93e366244bf9bc81f3e68c897fcc" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union<span class="token punctuation">,</span> Optional<span class="token punctuation">,</span> Protocol

<span class="token keyword">class</span> <span class="token class-name">Exitable</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Quittable</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span>task<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>Exitable<span class="token punctuation">,</span> Quittable<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">QuitJob</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">ExitJob</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">Server</span><span class="token punctuation">:</span> 
	<span class="token keyword">def</span> <span class="token function">run_forever</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">></span> NoReturn<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""no return"""</span>

finish<span class="token punctuation">(</span>QuitJob<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># OK</span>
finish<span class="token punctuation">(</span>ExitJob<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># OK</span>
finish<span class="token punctuation">(</span>Server<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Error</span></span></span></span></code></pre><div id="https://www.notion.so/6b7a35cc72bb4a5f98552f23d57db381" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这个例子中，我们定义了两种协议，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Exitable</code></span><span class="SemanticString"> 和 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Quittable</code></span><span class="SemanticString">，同时在传参时支持它们俩的并集，那么只要实现了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">exit(self) -&gt; int</code></span><span class="SemanticString"> 或 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">quit(self) -&gt; int</code></span><span class="SemanticString"> 的对象都会被接受。</span></span></p></div><div id="https://www.notion.so/7ae37932325f47428be52fa61c60cd0b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">关于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Protocol</code></span><span class="SemanticString"> 的其他定义和示例，可以通过 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0544">PEP 544</a></span><span class="SemanticString"> 了解更多，这里就不再展开了。</span></span></p></div><h3 id="https://www.notion.so/7b1e1db854a54440969c43e94b895414" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7b1e1db854a54440969c43e94b895414"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">自定义类型</span></span></h3><h3 id="https://www.notion.so/c763b7ecaef44ea0921cd39146350a12" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/c763b7ecaef44ea0921cd39146350a12"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">普通用法</span></span></h3><div id="https://www.notion.so/06286e5776734211ba934651fa038eae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Type</code></span><span class="SemanticString"> 来接受子类</span></span></p></div><pre id="https://www.notion.so/713510ad997a4ea8ab5a74b82b492ec1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Type

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">BasicUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">ProUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">TeamUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># Accepts User, BasicUser, ProUser, TeamUser, ...</span>
<span class="token keyword">def</span> <span class="token function">make_new_user</span><span class="token punctuation">(</span>user_class<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> User<span class="token punctuation">:</span>
	<span class="token keyword">return</span> user_class<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/26a1eca1ca884620924c228a2412f50c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/26a1eca1ca884620924c228a2412f50c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">类型自定义时</span></span></h3><div id="https://www.notion.so/2ca51ba352f14617b2d4907afceaf84c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">不使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span></span></p></div><pre id="https://www.notion.so/b845dbc727a841bdab1aedacb11df0b6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span>
<span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">newborn</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'Animal'</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> cls<span class="token punctuation">(</span>name<span class="token punctuation">,</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/efeaa24666c5403a8a35ce26f357dcfb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">正如上面提到，我们还可以用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span><span class="SemanticString"> 来创造类型，</span></span></p></div><pre id="https://www.notion.so/fb0e1fdf72244a98b0d2d334f26895fc" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>TAnimal <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"TAnimal"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span>Generic<span class="token punctuation">(</span><span class="token string">"TAnimal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token decorator annotation punctuation">@classmethod</span>
	<span class="token keyword">def</span> <span class="token function">newborn</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> TAnimal<span class="token punctuation">:</span>
		<span class="token keyword">return</span> cls<span class="token punctuation">(</span>name<span class="token punctuation">,</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/5a15bf1ede7948319afe0db317001d7c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">倘若此时还有继承，需要添加参数 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bound</code></span></span></p></div><pre id="https://www.notion.so/0b180a2918634611ad3d4f9b75982262" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Type<span class="token punctuation">,</span> TypeVar

TAnimal <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"TAnimal"</span><span class="token punctuation">,</span> bound<span class="token operator">=</span><span class="token string">"Animal"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span>
	<span class="token decorator annotation punctuation">@classmethod</span>
	<span class="token keyword">def</span> <span class="token function">newborn</span><span class="token punctuation">(</span>cls<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>TAnimal<span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> TAnimal<span class="token punctuation">:</span>
		<span class="token keyword">return</span> cls<span class="token punctuation">(</span>name<span class="token punctuation">,</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">bark</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> says woof!"</span></span><span class="token punctuation">)</span>

fido <span class="token operator">=</span> Dog<span class="token punctuation">.</span>newborn<span class="token punctuation">(</span><span class="token string">"Fido"</span><span class="token punctuation">)</span>
fido<span class="token punctuation">.</span>bark<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/4e570988d51e43dc875a8f3d7f08075f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4e570988d51e43dc875a8f3d7f08075f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">辅助函数</span></span></h3><div id="https://www.notion.so/ed537e878a674e71a267b418b5355ba1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有时候我们并不想在简单类型上多费精力，可以直接使用辅助函数来快捷创建类型。</span></span></p></div><pre id="https://www.notion.so/3716d153748b4b2da0f4a08ca3a58945" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> NewType

UserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'UserId'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
some_id <span class="token operator">=</span> UserId<span class="token punctuation">(</span><span class="token number">524313</span><span class="token punctuation">)</span>

<span class="token comment"># 类型可以再次被创建</span>
ProUserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'ProUserId'</span><span class="token punctuation">,</span> UserId<span class="token punctuation">)</span>
some_pro_id <span class="token operator">=</span> ProUserId<span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">)</span></span></span></span></code></pre><h2 id="https://www.notion.so/a99bbbbb86e94cdb87664898d453316a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/a99bbbbb86e94cdb87664898d453316a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">typing-extensions</span></span></h2><div id="https://www.notion.so/ad56915aec8049d08353d18af76e124c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing</code></span><span class="SemanticString"> 模块已经被引入标准库，其发布频率需要和 Python 发行版保持一致，所以有很多新类型被放到了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing-extensions</code></span><span class="SemanticString"> 中，我们可以通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pip</code></span><span class="SemanticString"> 安装它。</span></span></p></div><pre id="https://www.notion.so/9dc07a5b04924ee79fc347f4596146af" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pip <span class="token function">install</span> typing-extensions</span></span></span></code></pre><div id="https://www.notion.so/6b6e24c363b945959b6c111c5f1d8335" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing-extensions</code></span><span class="SemanticString">中有很多特殊类型，下面我们简单举一个小例子，其他的大家可以自行探索。</span></span></p></div><h3 id="https://www.notion.so/e4dccbfc5d74429ab83140cc8467e8dd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e4dccbfc5d74429ab83140cc8467e8dd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">实例：简化的枚举类型</span></span></h3><pre id="https://www.notion.so/d6c43d50ef4e43428b9521f13f323f44" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing_extensions <span class="token keyword">import</span> Literal

<span class="token comment"># Literal 表示字面类型</span>
<span class="token keyword">def</span> <span class="token function">fetch_data</span><span class="token punctuation">(</span>raw<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span></span></span></code></pre><div id="https://www.notion.so/bbea40a1095e4a97b49be5d187ec4787" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">原则上这里就只能输入字符串 &quot;red&quot; &quot;blue&quot; &quot;yellow&quot;，某些简单的场景下，我们不用额外定义枚举类型。</span></span></p></div><h2 id="https://www.notion.so/9a3db0c165c24a31b27b2b0b5b985911" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/9a3db0c165c24a31b27b2b0b5b985911"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">工程技巧</span></span></h2><h3 id="https://www.notion.so/4eaadb55a430433d93192048d5f8746f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4eaadb55a430433d93192048d5f8746f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">避免循环引用</span></span></h3><div id="https://www.notion.so/d7f799c087e741f8853217c9aa1c4844" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A 模块：</span></span></p></div><pre id="https://www.notion.so/078623bd93d84cbbb3072bc0b33952bf" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> B <span class="token keyword">import</span> AppFooController

<span class="token keyword">class</span> <span class="token class-name">App</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>name <span class="token operator">=</span> name


<span class="token keyword">def</span> <span class="token function">create_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	controller <span class="token operator">=</span> AppFooController<span class="token punctuation">(</span>App<span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/e3d94c1605b6461bb533afa88bc39bb2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这个场景下，B 模块并不是真正的需要引用 A 模块的内容，而是需要获得 A 模块内容的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing hint</code></span><span class="SemanticString">，如果直接引用会导致循环 import，可以通过如下方法规避：</span></span></p></div><pre id="https://www.notion.so/5f3137b5fd504fdeb65950611260ac74" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> TYPE_CHECKING

<span class="token keyword">if</span> TYPE_CHECKING<span class="token punctuation">:</span>
    <span class="token keyword">from</span> A <span class="token keyword">import</span> App
    
<span class="token keyword">class</span> <span class="token class-name">AppFooController</span><span class="token punctuation">:</span>
    <span class="token comment"># 注意：TYPE_CHECKING 语句下 import 的内容，都必须用引号包裹</span>
    app<span class="token punctuation">:</span> <span class="token string">'App'</span></span></span></span></code></pre><div id="https://www.notion.so/a4e0423b538d406cbce021f9fc2c3d98" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TYPING_CHECKING</code></span><span class="SemanticString"> 在运行时将永远为 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">False</code></span><span class="SemanticString">，所以并不会真正 import A 模块，同时也能起到 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">hint</code></span><span class="SemanticString"> 的作用。</span></span></p></div><h2 id="https://www.notion.so/8a151af822cd4ad8ae82945c50413685" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8a151af822cd4ad8ae82945c50413685"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">mypy</span></span></h2><div id="https://www.notion.so/5321dbe74505497e96dbe9b92c30b5c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/python/mypy">mypy</a></span><span class="SemanticString"> 原来是一个兼容大部分 Python 语法的静态类型的 Python 发行版，后来在官方受到启发，并加入类型注解之后，mypy 已经演化成了一个静态类型检查器，我们可以通过 pip 来安装</span></span></p></div><pre id="https://www.notion.so/3050e4d5888b425180ca887d247ad2d4" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pip <span class="token function">install</span> mypy</span></span></span></code></pre><div id="https://www.notion.so/5241d64e0f8a4525be38a24a17188e9d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在某些场景下，我们可以通过 mypy 来对项目进行全局扫描</span></span></p></div><pre id="https://www.notion.so/7e5b94c1759e4926b9be97927e114a39" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>➜ mypy some-python-project-path/
foo/utils/sanitizer.py:18: error: Cannot <span class="token function">find</span> module named <span class="token string">'bleach.encoding'</span>
foo/utils/sanitizer.py:19: error: Cannot <span class="token function">find</span> module named <span class="token string">'bleach.sanitizer'</span>
foo/fake/tee/gitlab/client.py:5: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar'</span>
foo/fake/tee/gitlab/client.py:6: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar'</span>
foo/fake/tee/gitlab/client.py:7: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar.objects'</span>
foo/accessories/fake/tags.py:48: error: <span class="token string">"type"</span> has no attribute <span class="token string">"tag_type"</span>
foo/utils/log.py:4: error: Cannot <span class="token function">find</span> module named <span class="token string">'logstash'</span>
foo/utils/log.py:5: error: No library stub <span class="token function">file</span> <span class="token keyword">for</span> module <span class="token string">'redis'</span>
foo/utils/detector.py:32: error: Need <span class="token builtin class-name">type</span> annotation <span class="token keyword">for</span> <span class="token string">'detect_map'</span>
foo/utils/basic.py:3: error: Cannot <span class="token function">find</span> module named <span class="token string">'past.utils'</span>
foo/utils/basic.py:9: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar'</span>
foo/utils/basic.py:10: error: Cannot <span class="token function">find</span> module named <span class="token string">'aenum'</span></span></span></span></code></pre><div id="https://www.notion.so/f4e667955aa2439eadd44067ea3c7242" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在我们项目整体类型注解完善的情况下，可以考虑将 mypy 放到 CI 的流程中。</span></span></p></div><div id="https://www.notion.so/c688cfcafdbd407dbccbdc2b81927c10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">比如 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/tornadoweb/tornado">Tornado</a></span><span class="SemanticString"> 的源码基本已经做到 100% 静态了，扫描整个工程只有两个小问题：</span></span></p></div><pre id="https://www.notion.so/0292568fb89d4eb7b44860f9aecfc696" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>➜ mypy tornado/
tornado/testing.py:263: error: Return <span class="token builtin class-name">type</span> of <span class="token string">"run"</span> incompatible with supertype <span class="token string">"TestCase"</span>
tornado/testing.py:270: error: Incompatible <span class="token builtin class-name">return</span> value <span class="token builtin class-name">type</span> <span class="token punctuation">(</span>got <span class="token string">"Optional[TestResult]"</span>, expected <span class="token string">"TestCase"</span><span class="token punctuation">)</span></span></span></span></code></pre><h2 id="https://www.notion.so/b8251b5de0ed4a009046014a4e0ccece" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b8251b5de0ed4a009046014a4e0ccece"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">再让我们看看那个例子</span></span></h2><div id="https://www.notion.so/452d846229df4c5c98fc310af69dcef6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下是在 Pycharm 里提示的样子：</span></span></p></div><div id="https://www.notion.so/b08e170bc1e142b687d294b38b197084" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/410dacbac1c94cba9157faf697522cab" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F18f3b568-28f8-4ac2-bd73-be3454394ba8%2FUntitled.png?width=488&amp;table=block&amp;id=410dacba-c1c9-4cba-9157-faf697522cab"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F18f3b568-28f8-4ac2-bd73-be3454394ba8%2FUntitled.png?width=488&amp;table=block&amp;id=410dacba-c1c9-4cba-9157-faf697522cab" style="width:488px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1b60bf87498f40e18134246e14623434" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/5efcd452327e4075990e292fe2a10916" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">好了，只要加上了类型注解，那个 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">企图让所有变量都变成元组</strong></span><span class="SemanticString"> 的&quot;元凶&quot;——逗号，就无处遁形了 xD</span></span></p></div><h2 id="https://www.notion.so/bf161aa254614b2fb035dc1f83cef7b1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/bf161aa254614b2fb035dc1f83cef7b1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">结语</span></span></h2><div id="https://www.notion.so/89db472338404523b6011fe422684edb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">类型注解给 Python 带来了全新的开发体验，相信此刻的你也有了答案，让 Python “静态” 起来吧。</span></span></p></div><div id="https://www.notion.so/b6eb59dd4c1d4157be0303c732df0e00" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">参考文档：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/2a5bbab70a614a85b581ee48d6d997c5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://dev.to/dstarner/using-pythons-type-annotations-4cfe">Using Python&#x27;s Type Annotations</a></span></span></li><li id="https://www.notion.so/c9d189a0895d49668133e231937d5433" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://realpython.com/python-type-checking/">The Ultimate Guide to Python Type Checking</a></span></span></li><li id="https://www.notion.so/0b30bcfb927c4bfebf29c2b0054725b6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0483/">PEP 483</a></span></span></li><li id="https://www.notion.so/e600da9f6530415697a675e33c47b48d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a></span></span></li><li id="https://www.notion.so/0f4b004dfe64429a9a6c521a15bfd36a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a></span></span></li><li id="https://www.notion.so/8cf0ae9dd71c48a6a39c36ea0e182c1d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.python.org/zh-cn/3/library/typing.html">typing library</a></span></span></li></ul></article>
  <div>
    <!-- utterances - Github issue comment -->
    <script src="https://utteranc.es/client.js"
	repo="IMBlues/IMBlues.github.io"
	issue-term="pathname"
	label="blog-comment"
	theme="github-light"
	crossorigin="anonymous"
	async>
    </script>
  </div>

  <footer class="Footer">
        <div>&copy; 布鲁斯🐟的奇思乱想 2021</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
  </footer>
</body>

</html>
