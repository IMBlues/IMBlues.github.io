<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WV23EXEF9X"></script>
<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-WV23EXEF9X');
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F66ae2268-69fb-4a91-a4a8-fea3ba4543a5%2Fbluesyu.png?table=collection&amp;id=12c44699-617b-45ed-a019-c3b075e0ae01">

<style>
  :root {
    font-size: 20px;
  }
</style>

  <title>让你的 Python 静态起来&nbsp;|&nbsp;布鲁斯鱼的奇思乱想 💭</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="让你的 Python 静态起来">
  
    <meta name="description" content="旧文重发">
    <meta property="og:description" content="旧文重发">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🐍&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F66ae2268-69fb-4a91-a4a8-fea3ba4543a5%2Fbluesyu.png?table=collection&amp;id=12c44699-617b-45ed-a019-c3b075e0ae01"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3a9bcf6a-f4f8-4580-93a6-b21a38a8914b%2F988431636594419_.pic.jpg?table=block&amp;id=78f0b500-97be-4b05-ad6d-630418880655"></span>&nbsp;
          
          <span>关于我</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="next.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🗯️&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>妙想天开</span>
        </div>
      </a>
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://pm1.narvii.com/6310/4ab2456aa8243f397d6e472e44b3b0cb4c211006_hq.jpg">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🐍&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">让你的 Python 静态起来</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Mon, Apr 1, 2019</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/python.html">python</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/pep.html">pep</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/tech.html">tech</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/673ad65d30c047adac39cd4b97602abb" class="PageRoot"><ul id="https://www.notion.so/2bc93847e90c40d5b4b6d122f0c00f5c" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/aae170c2eae24621adab241e5c619a48"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">为什么要 “静态”？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f57aca897a0d43989cd5da4deac6aea3"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Typing Annotation</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2c9b51f2e14742759947ec3fdd7dbfb0"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">类型注释？</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5cc061b72ccb4dcb8eef9683c8e82eeb"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Gradual typing</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/24f0053a340a447fb24d20fb5540ccec"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Types 和 Classes</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9d1c1fa781544873b08dba4f68c8c709"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">各种使用场景</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ff5966003e0e4f11b6a2884c59db0ac8"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">基本类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f73739d2be1247f3a1b1d5cdceeae323"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">容器类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ea531acb29114a05b1439c955d6d11cd"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">类型别名</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/24b34e43ba894f73834376c07d78e75c"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">函数类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9f5be43dd6e84273a3014aa5e0dcff8c"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">“泛” 型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6a112b14ebb94b3389bb6067a88176ab"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Any</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/489c17daa28f4bb3a876a112399c9c88"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">TypeVar</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/dc4a478e790b4cb3b4af2b4abc8cf244"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">函数的“泛”型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1b5eb43770194645927492d9ed163c5b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Union 和 Optional</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/280e3b9d9246476d9aae58bb65a9c851"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Django model</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/305e503c2679490ab8398106dd302ec6"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Protocol</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/3d773a71cfc947f99c2b2ffc31861c63"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">自定义类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6ff7777904884c669db3fac2a5b907f9"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">普通用法</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d36c62d3684c4d60b2e4b1f376f66c4b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">类型自定义时</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/79ba890997524aa1aec67850427a8186"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">辅助函数</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4d6c91207ae8404bbd006d3032dc0a1f"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">typing-extensions</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1e36ff481a11481f8a2e9fcd811a5f94"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">实例：简化的枚举类型</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d152db561ffc41c694379bf1ab339aed"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">工程技巧</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/31b7c3828239402396820bd7644d6862"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">避免循环引用</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/fb520b70a0b44f189857a7163d31da80"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">mypy</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5927d93d74d245b4968d2de327e68d9b"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">再让我们看看那个例子</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f2f4c9b3f9594d6cad103fc288c2f07b"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">结语</span></span></div></a></li></ul><h2 id="https://www.notion.so/aae170c2eae24621adab241e5c619a48" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/aae170c2eae24621adab241e5c619a48"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">为什么要 “静态”？</span></span></h2><div id="https://www.notion.so/a759c1ad6ec3427992a2b5fae4da06b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在一切开始前，我们可以先看一个小例子:</span></span></p></div><pre id="https://www.notion.so/6126f77ef2944547859dbe0bf759368b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">get_weapons_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	weapon_status <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"LeviathanAxe"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
		<span class="token string">"BladesofChaos"</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> weapon_status<span class="token punctuation">,</span>


weapons_status <span class="token operator">=</span> get_weapons_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> weapon<span class="token punctuation">,</span> status <span class="token keyword">in</span> weapons_status<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> status<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>weapon<span class="token punctuation">}</span></span><span class="token string"> is ready"</span></span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/0cd81834a56246e1ace8b01656328c4b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在我们的预想里，上述代码应该会输出 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LeviathanAxe is ready</code></span><span class="SemanticString">，但实际运行则会报错：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">AttributeError: &#x27;tuple&#x27; object has no attribute &#x27;items&#x27;</code></span></span></p></div><div id="https://www.notion.so/b5b96d03f69641c596d044ad823aea80" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">眼尖的同学肯定发现了，这段代码的问题是在 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">get_weapons_status</code></span><span class="SemanticString">的</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">return</code></span><span class="SemanticString"> 语句后多加了一个 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">,</code></span><span class="SemanticString">，所以函数的返回值并不是预期的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dict</code></span><span class="SemanticString"> 类型，而是 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">tuple</code></span><span class="SemanticString">。然而对于这样的写法，IDE 可能不会有明显提示，所以在我们做</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">大段的</strong></span><span class="SemanticString">代码重构或迁移时，它们很容易被忽略，直到运行时才会冒出来。</span></span></p></div><div id="https://www.notion.so/c16e6d847db94654a7e2bd6cd75adc1b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们常把这类问题归结于自己的粗心大意，但是没有想过它们的“原罪”其实应该是 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Python 的动态</strong></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/ba4d7ca89d9b499096b0ecd552301475" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">诚然，Python 的动态给我们带来了诸多酷炫的特性：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">monkey_patch</code></span><span class="SemanticString">、各种魔法方法、极为方便的 mock 测试.....但在逻辑分层设计、参数校验、代码补全时我们又无比渴望一些 “静态” 特性。</span></span></p></div><div id="https://www.notion.so/44fd20d9376f4a108776f012ba119670" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">所以，如果 Python 能够 “静态” 一些，将会给我们带来几个明显的增益：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/51962a22e19447d0b20bdc3ae2041d9b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">大幅度提升代码的可读性</span></span></li><li id="https://www.notion.so/05bb62a0697342a287e17d6cf2bfd20c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">能够将参数传递时的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">类型错误</code></span><span class="SemanticString"> 扼杀在摇(biān)篮(mǎ)中</span></span></li><li id="https://www.notion.so/bd4c624a13b94ccfb668d7d0bf8e3e4f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">能够最大程度利用 IDE 提供的代码提示，减少 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typo</code></span></span></li></ul><div id="https://www.notion.so/ba59c8e7653544e4947fa8f5ca224b98" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么该如何拥有这些“静态”的特性呢？下面我们将时间留给本文的主角——</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing annotaion</code></span><span class="SemanticString">。</span></span></p></div><h2 id="https://www.notion.so/f57aca897a0d43989cd5da4deac6aea3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f57aca897a0d43989cd5da4deac6aea3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Typing Annotation</span></span></h2><div id="https://www.notion.so/77011bce293841558018dd951bc747d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">从 Python 3.5 开始， </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">type annotation</code></span><span class="SemanticString"> 已经正式被引入了。</span></span></p></div><div id="https://www.notion.so/e0959c21e21a4bb398d206277663027c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们可以对任何变量进行类型注解，无论是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">赋值之前</strong></span><span class="SemanticString">还是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">函数传参和返回</strong></span></span></p></div><pre id="https://www.notion.so/bfb2b503b8854bdcbc4d57652f0301e9" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># 我们可以从类、模块、函数的 `__annotations__` 变量中获取这些注解</span>
nine_realms<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Niflheim"</span><span class="token punctuation">,</span> <span class="token string">"Muspelheim"</span><span class="token punctuation">,</span> <span class="token string">"Asgard"</span><span class="token punctuation">,</span> <span class="token string">"Midgard"</span><span class="token punctuation">,</span> <span class="token string">"Jotunheim"</span><span class="token punctuation">,</span> <span class="token string">"Vanaheim"</span><span class="token punctuation">,</span> <span class="token string">"Alfheim"</span><span class="token punctuation">,</span> <span class="token string">"Svartalfheim"</span><span class="token punctuation">,</span> <span class="token string">"Helheim"</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">Yggdrasill</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">transport</span><span class="token punctuation">(</span>realm<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
		<span class="token keyword">pass</span>
</span></span></span></code></pre><h3 id="https://www.notion.so/2c9b51f2e14742759947ec3fdd7dbfb0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2c9b51f2e14742759947ec3fdd7dbfb0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">类型注释？</span></span></h3><div id="https://www.notion.so/de04713d7f9440fc8b1772953d1d110b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">除了“注解”，我们也可以使用类型注释</span></span></p></div><pre id="https://www.notion.so/cc6439e9279b415191509a4917980785" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pi <span class="token operator">=</span> <span class="token number">3.142</span> <span class="token comment"># type: float</span></span></span></span></code></pre><div id="https://www.notion.so/3157a1e17e2b4e959c557e982049e1f6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">相较于“注解”，注释对代码的侵入性更小，但同时可读性更差，只适用于不支持注解的场景。官方推荐使用类型注解，所以类型注释的内容就不再展开了。</span></span></p></div><h3 id="https://www.notion.so/5cc061b72ccb4dcb8eef9683c8e82eeb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5cc061b72ccb4dcb8eef9683c8e82eeb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Gradual typing</span></span></h3><div id="https://www.notion.so/e4602f8a33784593aa981fdd8ec3421b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">类型注解只会生存于“编码时”，并不影响运行时，我们可以放心大胆地为旧代码添加注解，而不用担心对实际功能产生影响。当然对于大型项目（只要注解本身不写错），我们可以采取“渐进式注解”，对一些关键的核心模块先进行改造，详见 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0483/#summary-of-gradual-typing">gradual typing</a></span></span></p></div><h3 id="https://www.notion.so/24f0053a340a447fb24d20fb5540ccec" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/24f0053a340a447fb24d20fb5540ccec"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Types 和 Classes</span></span></h3><div id="https://www.notion.so/64b769958fc3475bb425d70b59d56f8a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">需要额外说明的是，在类型注解中，我们经常会使用 “类(class)” 和 “类型(type)” 做注解：</span></span></p></div><pre id="https://www.notion.so/5b6f757dbd7148d4aa75f06df3ab8eda" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"Atreus"</span>

<span class="token keyword">from</span> typing <span class="token keyword">import</span> List
names<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Atreus"</span><span class="token punctuation">,</span> <span class="token string">"Loki"</span><span class="token punctuation">]</span></span></span></span></code></pre><div id="https://www.notion.so/80c81ab0d4454c2a9954e78a5d084594" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其中 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">str</code></span><span class="SemanticString"> 既是一种 “类”，同时也是一种 “类型”，而 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">List</code></span><span class="SemanticString"> 只是一种 “类型”，我们是不能够在 “运行时” 使用它们的，例如：</span></span></p></div><pre id="https://www.notion.so/fa99ec245be94e4c8d9633b7ddb054d2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Names</span><span class="token punctuation">(</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># raises TypeError</span></span></span></span></code></pre><div id="https://www.notion.so/df16a3768ddf4fc89ed2c8ee33439df4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">简单来说，任何一种 “类” 都可以被当作一种 ”类型“，反过来 ”类型” 却不一定能被当作 “类” 使用。</span></span></p></div><h2 id="https://www.notion.so/9d1c1fa781544873b08dba4f68c8c709" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/9d1c1fa781544873b08dba4f68c8c709"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">各种使用场景</span></span></h2><div id="https://www.notion.so/52298fea7d9c43f1a363c4c4d251b611" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">下面我们主要将常用的类型注解结合工程场景举例</span></span></p></div><h3 id="https://www.notion.so/ff5966003e0e4f11b6a2884c59db0ac8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ff5966003e0e4f11b6a2884c59db0ac8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">基本类型</span></span></h3><pre id="https://www.notion.so/b2b11e1b181142898e38ccae763b02ea" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">hey_boy</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token string">'Boy: '</span> <span class="token operator">+</span> name</span></span></span></code></pre><div id="https://www.notion.so/f74e4b89121847b291aee69f76e6b0fe" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">正如上面提到，任何基本类型都可以直接当做注解使用，包括但不限于：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">int</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">str</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">list</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dict</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">set</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">None</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bool</code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">tuple</code></span><span class="SemanticString">等等，</span></span></p></div><h3 id="https://www.notion.so/f73739d2be1247f3a1b1d5cdceeae323" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/f73739d2be1247f3a1b1d5cdceeae323"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">容器类型</span></span></h3><pre id="https://www.notion.so/23d4b1f20c76423b9986c6539b83a4c5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token comment"># 纯容器</span>
<span class="token keyword">def</span> <span class="token function">print_names</span><span class="token punctuation">(</span>names<span class="token punctuation">:</span> List<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token comment"># 容器 &amp; 容器内元素</span>
<span class="token keyword">def</span> <span class="token function">print_names</span><span class="token punctuation">(</span>names<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

print_names<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Kratos'</span><span class="token punctuation">,</span> <span class="token string">'Thor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
print_names<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'any_type'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 不被允许，容器内元素类型不一致</span>

<span class="token keyword">def</span> <span class="token function">print_names</span><span class="token punctuation">(</span>names<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

print_names<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'Blues'</span><span class="token punctuation">:</span> <span class="token string">'Yu'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/ea531acb29114a05b1439c955d6d11cd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ea531acb29114a05b1439c955d6d11cd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">类型别名</span></span></h3><div id="https://www.notion.so/2b7a8384a5894bd781a5a277572d85d4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">容器内元素会非常复杂，我们可能会有类似 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dict[str, Dict[str: SomeObject]]</code></span><span class="SemanticString"> 这种不容易阅读的写法，此时我们也可以用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">类型别名</code></span><span class="SemanticString">来简化。</span></span></p></div><pre id="https://www.notion.so/e2d50629e8e340d9b9453bc4cf3b538f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict

Point <span class="token operator">=</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">:</span> SomeObject<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">print_points</span><span class="token punctuation">(</span>points<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Point<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> point <span class="token keyword">in</span> points<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"X:"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" Y:"</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/24b34e43ba894f73834376c07d78e75c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/24b34e43ba894f73834376c07d78e75c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">函数类型</span></span></h3><div id="https://www.notion.so/6753258de1054767962edce9c3d9b037" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在类似装饰器、回调等场景下，我们需要对函数参数作注解，基本的格式为：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Callable[[Arg1Type, Arg2Type], ReturnType]</code></span><span class="SemanticString">。其中 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">[Arg1Type, Arg2Type]</code></span><span class="SemanticString"> 是输入参数列表，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ReturnType</code></span><span class="SemanticString"> 是返回内容。</span></span></p></div><pre id="https://www.notion.so/d55c17383c4748bdb662478e92fa9682" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Callable

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>func<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span> argument<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>func<span class="token punctuation">(</span>argument<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span>

foo<span class="token punctuation">(</span>create_greeting<span class="token punctuation">,</span> <span class="token string">"Jekyll"</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/9f5be43dd6e84273a3014aa5e0dcff8c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9f5be43dd6e84273a3014aa5e0dcff8c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">“泛” 型</span></span></h3><h3 id="https://www.notion.so/6a112b14ebb94b3389bb6067a88176ab" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/6a112b14ebb94b3389bb6067a88176ab"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Any</span></span></h3><div id="https://www.notion.so/6151c1727c5f4fbbb5797229555aa856" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有时候我们对于某些“泛”型变量，我们可以用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Any</code></span><span class="SemanticString"> 来表明</span></span></p></div><pre id="https://www.notion.so/4d7e9191734e4cb0891c8f2606f2e145" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> AnyStr<span class="token punctuation">,</span> Any

<span class="token comment"># 任意类型</span>
<span class="token comment"># Any 兼容任意类型</span>
<span class="token keyword">def</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> Any<span class="token punctuation">,</span> b<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Any<span class="token punctuation">:</span>
	<span class="token keyword">pass</span></span></span></span></code></pre><h3 id="https://www.notion.so/489c17daa28f4bb3a876a112399c9c88" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/489c17daa28f4bb3a876a112399c9c88"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TypeVar</span></span></h3><div id="https://www.notion.so/e44fa824781742fba633568949685460" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span><span class="SemanticString"> 表示 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Type</code></span><span class="SemanticString"> 类型。简单来说，她就是“类型”的“类型”。和 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">type</code></span><span class="SemanticString"> 可以创造 “类” 一样，我们可以通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span><span class="SemanticString"> 来创造 “类型”。</span></span></p></div><div id="https://www.notion.so/5543ca320f934419b8badbb311cfb03f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">例如 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing</code></span><span class="SemanticString"> 中提供的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">AnyStr</code></span><span class="SemanticString"> 其实就是通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar(&#x27;AnyStr&#x27;, Text, bytes)</code></span><span class="SemanticString"> 来表示的。</span></span></p></div><pre id="https://www.notion.so/40da79d498754ad5b1dea115375c60e8" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># 任意字符型</span>
<span class="token comment"># AnyStr = TypeVar('AnyStr', Text, bytes)</span>

<span class="token keyword">def</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> AnyStr<span class="token punctuation">,</span> b<span class="token punctuation">:</span> AnyStr<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> AnyStr<span class="token punctuation">:</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b

concat<span class="token punctuation">(</span><span class="token string">u"foo"</span><span class="token punctuation">,</span> <span class="token string">u"bar"</span><span class="token punctuation">)</span> 
concat<span class="token punctuation">(</span><span class="token string">b"foo"</span><span class="token punctuation">,</span> <span class="token string">b"bar"</span><span class="token punctuation">)</span> 
concat<span class="token punctuation">(</span><span class="token string">u"foo"</span><span class="token punctuation">,</span> <span class="token string">b"bar"</span><span class="token punctuation">)</span>

<span class="token comment"># 以上三种写法都会被类型检查接受，但是运行时，最后一种调用会报错 `TypeError: can't concat str to bytes`</span></span></span></span></code></pre><h3 id="https://www.notion.so/dc4a478e790b4cb3b4af2b4abc8cf244" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/dc4a478e790b4cb3b4af2b4abc8cf244"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">函数的“泛”型</span></span></h3><div id="https://www.notion.so/0f2bfb351ada4313a27c5f3660c43556" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有时候，函数可能需要支持多种类型输入输出，我们可以通过多种方法来实现注解。</span></span></p></div><div id="https://www.notion.so/a6b6986d69be4968ac06a743913cb8e2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing.overload</code></span></span></p></div><pre id="https://www.notion.so/a8afe27ed166469a8a7029e042e054ee" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> overload<span class="token punctuation">,</span> List


<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>developers<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


<span class="token decorator annotation punctuation">@overload</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>developers<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


<span class="token comment"># 这里不能有类型注解，并且需要实现一个通用的做法</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>developers<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 "ponyma,jackma,allenzhang"</span>
		developers <span class="token operator">=</span> developers<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers
	<span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> List<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 ["ponyma", "jackma", "allenzhang"]</span>
		developers <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>developers<span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers</span></span></span></code></pre><div id="https://www.notion.so/bcc78587140c494b91e6dd581658b53f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Union[Type1, Type2]</code></span></span></p></div><pre id="https://www.notion.so/de2ed3dce45746d8925979267396a610" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Union[X, Y] 意味着是 X 或 Y 类型</span>
<span class="token keyword">def</span> <span class="token function">switch_names</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> List<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 "ponyma,jackma,allenzhang"</span>
		developers <span class="token operator">=</span> developers<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers
	<span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>developers<span class="token punctuation">,</span> List<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 例如 ["ponyma", "jackma", "allenzhang"]</span>
		developers <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>developers<span class="token punctuation">)</span>
		<span class="token keyword">return</span> developers</span></span></span></code></pre><h3 id="https://www.notion.so/1b5eb43770194645927492d9ed163c5b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/1b5eb43770194645927492d9ed163c5b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Union 和 Optional</span></span></h3><pre id="https://www.notion.so/0f6b4134eaef41dc934380b11ccb2566" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union

<span class="token comment"># 通常的 Union 用法</span>
<span class="token keyword">def</span> <span class="token function">print_grade</span><span class="token punctuation">(</span>grade<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>grade<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>grade <span class="token operator">+</span> <span class="token string">' percent'</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' percent'</span><span class="token punctuation">)</span>

<span class="token comment"># Optional[X] 相当于 Union[X, None]</span>
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>optional_info<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> optional_info <span class="token keyword">or</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span></span></span></code></pre><h3 id="https://www.notion.so/280e3b9d9246476d9aae58bb65a9c851" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/280e3b9d9246476d9aae58bb65a9c851"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Django model</span></span></h3><pre id="https://www.notion.so/a8ad0ca6f7114224b2957786fba19d3a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union<span class="token punctuation">,</span> List
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> QuerySet
<span class="token keyword">from</span> my_app<span class="token punctuation">.</span>models <span class="token keyword">import</span> MyModel

<span class="token comment"># 在后续代码中，records 的类型将被等同于 MyModel 的 QuerySet</span>
<span class="token comment"># 不过同时需要注意，如果此时传入一个单纯的 List[MyModel]，</span>
<span class="token comment"># 并调用 QuerySet 的方法，静态检查是不会探测出问题的</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>records<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>QuerySet<span class="token punctuation">,</span> List<span class="token punctuation">[</span>MyModel<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span></span></span></span></code></pre><h3 id="https://www.notion.so/305e503c2679490ab8398106dd302ec6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/305e503c2679490ab8398106dd302ec6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Protocol</span></span></h3><div id="https://www.notion.so/99f43f11b88940e9bda618b312f41176" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">协议类型是一个特殊的结构化类型，它表示一种静态的鸭子类型，有点像是 Go 中的接口定义，但依旧只存在于“编码时”。</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Protocol</code></span><span class="SemanticString"> 的好处是，我们可以很明确的定义和使用鸭子类型，而不用人工核对方法的输入输出。</span></span></p></div><div id="https://www.notion.so/d2d0bb1bc6cf435091261f43f11c7732" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">举个例子：</span></span></p></div><pre id="https://www.notion.so/7bd16fd8c753457a9e550d287b1a5e01" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union<span class="token punctuation">,</span> Optional<span class="token punctuation">,</span> Protocol

<span class="token keyword">class</span> <span class="token class-name">Exitable</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Quittable</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span>task<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>Exitable<span class="token punctuation">,</span> Quittable<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">QuitJob</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">ExitJob</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">Server</span><span class="token punctuation">:</span> 
	<span class="token keyword">def</span> <span class="token function">run_forever</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">></span> NoReturn<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""no return"""</span>

finish<span class="token punctuation">(</span>QuitJob<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># OK</span>
finish<span class="token punctuation">(</span>ExitJob<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># OK</span>
finish<span class="token punctuation">(</span>Server<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Error</span></span></span></span></code></pre><div id="https://www.notion.so/7b34dc8049da4f48a2466bde8a9b7964" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这个例子中，我们定义了两种协议，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Exitable</code></span><span class="SemanticString"> 和 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Quittable</code></span><span class="SemanticString">，同时在传参时支持它们俩的并集，那么只要实现了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">exit(self) -&gt; int</code></span><span class="SemanticString"> 或 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">quit(self) -&gt; int</code></span><span class="SemanticString"> 的对象都会被接受。</span></span></p></div><div id="https://www.notion.so/e1ec1809b72240cb9c56393636e61604" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">关于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Protocol</code></span><span class="SemanticString"> 的其他定义和示例，可以通过 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0544">PEP 544</a></span><span class="SemanticString"> 了解更多，这里就不再展开了。</span></span></p></div><h3 id="https://www.notion.so/3d773a71cfc947f99c2b2ffc31861c63" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3d773a71cfc947f99c2b2ffc31861c63"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">自定义类型</span></span></h3><h3 id="https://www.notion.so/6ff7777904884c669db3fac2a5b907f9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/6ff7777904884c669db3fac2a5b907f9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">普通用法</span></span></h3><div id="https://www.notion.so/e01ee5cd8713456ea487596405d6831f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Type</code></span><span class="SemanticString"> 来接受子类</span></span></p></div><pre id="https://www.notion.so/2bed6264b9cc499b9dda764fd0eab412" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> Type

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">BasicUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">ProUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">TeamUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># Accepts User, BasicUser, ProUser, TeamUser, ...</span>
<span class="token keyword">def</span> <span class="token function">make_new_user</span><span class="token punctuation">(</span>user_class<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> User<span class="token punctuation">:</span>
	<span class="token keyword">return</span> user_class<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/d36c62d3684c4d60b2e4b1f376f66c4b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d36c62d3684c4d60b2e4b1f376f66c4b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">类型自定义时</span></span></h3><div id="https://www.notion.so/c6665522f535411ba8e4407d571cde31" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">不使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span></span></p></div><pre id="https://www.notion.so/9b3abcb8a0d54aaa8c14a6a989fbeafe" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span>
<span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">newborn</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'Animal'</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> cls<span class="token punctuation">(</span>name<span class="token punctuation">,</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/3c0da96442c843639dae7979b72b3787" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">正如上面提到，我们还可以用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TypeVar</code></span><span class="SemanticString"> 来创造类型，</span></span></p></div><pre id="https://www.notion.so/aacad5bf7f4940379c058fb3d2acf60d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>TAnimal <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"TAnimal"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span>Generic<span class="token punctuation">(</span><span class="token string">"TAnimal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token decorator annotation punctuation">@classmethod</span>
	<span class="token keyword">def</span> <span class="token function">newborn</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> TAnimal<span class="token punctuation">:</span>
		<span class="token keyword">return</span> cls<span class="token punctuation">(</span>name<span class="token punctuation">,</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/2d50245f8b9b44fabfa1f365d30032e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">倘若此时还有继承，需要添加参数 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bound</code></span></span></p></div><pre id="https://www.notion.so/fe54896e94f04817b3c3ce4c4842194a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Type<span class="token punctuation">,</span> TypeVar

TAnimal <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"TAnimal"</span><span class="token punctuation">,</span> bound<span class="token operator">=</span><span class="token string">"Animal"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span>
	<span class="token decorator annotation punctuation">@classmethod</span>
	<span class="token keyword">def</span> <span class="token function">newborn</span><span class="token punctuation">(</span>cls<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>TAnimal<span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> TAnimal<span class="token punctuation">:</span>
		<span class="token keyword">return</span> cls<span class="token punctuation">(</span>name<span class="token punctuation">,</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">bark</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> says woof!"</span></span><span class="token punctuation">)</span>

fido <span class="token operator">=</span> Dog<span class="token punctuation">.</span>newborn<span class="token punctuation">(</span><span class="token string">"Fido"</span><span class="token punctuation">)</span>
fido<span class="token punctuation">.</span>bark<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><h3 id="https://www.notion.so/79ba890997524aa1aec67850427a8186" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/79ba890997524aa1aec67850427a8186"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">辅助函数</span></span></h3><div id="https://www.notion.so/002c97baa4334f9587b12e156cfc3cf1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有时候我们并不想在简单类型上多费精力，可以直接使用辅助函数来快捷创建类型。</span></span></p></div><pre id="https://www.notion.so/4688f00a4c374bce86e21bebe6c44fc6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> NewType

UserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'UserId'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
some_id <span class="token operator">=</span> UserId<span class="token punctuation">(</span><span class="token number">524313</span><span class="token punctuation">)</span>

<span class="token comment"># 类型可以再次被创建</span>
ProUserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'ProUserId'</span><span class="token punctuation">,</span> UserId<span class="token punctuation">)</span>
some_pro_id <span class="token operator">=</span> ProUserId<span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">)</span></span></span></span></code></pre><h2 id="https://www.notion.so/4d6c91207ae8404bbd006d3032dc0a1f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4d6c91207ae8404bbd006d3032dc0a1f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">typing-extensions</span></span></h2><div id="https://www.notion.so/6c88aa8f23f54973969dbc4d628058f4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing</code></span><span class="SemanticString"> 模块已经被引入标准库，其发布频率需要和 Python 发行版保持一致，所以有很多新类型被放到了 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing-extensions</code></span><span class="SemanticString"> 中，我们可以通过 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pip</code></span><span class="SemanticString"> 安装它。</span></span></p></div><pre id="https://www.notion.so/c4e930e999d643ffb5c2f7710ee7b013" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pip <span class="token function">install</span> typing-extensions</span></span></span></code></pre><div id="https://www.notion.so/5659b7f6e31842f684f4b0c16ec7370d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing-extensions</code></span><span class="SemanticString">中有很多特殊类型，下面我们简单举一个小例子，其他的大家可以自行探索。</span></span></p></div><h3 id="https://www.notion.so/1e36ff481a11481f8a2e9fcd811a5f94" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/1e36ff481a11481f8a2e9fcd811a5f94"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">实例：简化的枚举类型</span></span></h3><pre id="https://www.notion.so/489b767d9e254237bf96c64e332da90e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing_extensions <span class="token keyword">import</span> Literal

<span class="token comment"># Literal 表示字面类型</span>
<span class="token keyword">def</span> <span class="token function">fetch_data</span><span class="token punctuation">(</span>raw<span class="token punctuation">:</span> Literal<span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span></span></span></code></pre><div id="https://www.notion.so/208689c2419b4627b73b884440115d36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">原则上这里就只能输入字符串 &quot;red&quot; &quot;blue&quot; &quot;yellow&quot;，某些简单的场景下，我们不用额外定义枚举类型。</span></span></p></div><h2 id="https://www.notion.so/d152db561ffc41c694379bf1ab339aed" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d152db561ffc41c694379bf1ab339aed"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">工程技巧</span></span></h2><h3 id="https://www.notion.so/31b7c3828239402396820bd7644d6862" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/31b7c3828239402396820bd7644d6862"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">避免循环引用</span></span></h3><div id="https://www.notion.so/4033c1ff50b14b85844d4058c24f19ed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A 模块：</span></span></p></div><pre id="https://www.notion.so/f15a8dffef7643138eb714351835039f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> B <span class="token keyword">import</span> AppFooController

<span class="token keyword">class</span> <span class="token class-name">App</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>name <span class="token operator">=</span> name


<span class="token keyword">def</span> <span class="token function">create_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	controller <span class="token operator">=</span> AppFooController<span class="token punctuation">(</span>App<span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/e43f896533244180af18e69599af6623" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这个场景下，B 模块并不是真正的需要引用 A 模块的内容，而是需要获得 A 模块内容的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">typing hint</code></span><span class="SemanticString">，如果直接引用会导致循环 import，可以通过如下方法规避：</span></span></p></div><pre id="https://www.notion.so/435664e03e33469ea28cc7fb362f9d9b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">from</span> typing <span class="token keyword">import</span> TYPE_CHECKING

<span class="token keyword">if</span> TYPE_CHECKING<span class="token punctuation">:</span>
    <span class="token keyword">from</span> A <span class="token keyword">import</span> App
    
<span class="token keyword">class</span> <span class="token class-name">AppFooController</span><span class="token punctuation">:</span>
    <span class="token comment"># 注意：TYPE_CHECKING 语句下 import 的内容，都必须用引号包裹</span>
    app<span class="token punctuation">:</span> <span class="token string">'App'</span></span></span></span></code></pre><div id="https://www.notion.so/39fed9222cc541a886ab0da3c3e72363" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里的 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">TYPING_CHECKING</code></span><span class="SemanticString"> 在运行时将永远为 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">False</code></span><span class="SemanticString">，所以并不会真正 import A 模块，同时也能起到 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">hint</code></span><span class="SemanticString"> 的作用。</span></span></p></div><h2 id="https://www.notion.so/fb520b70a0b44f189857a7163d31da80" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/fb520b70a0b44f189857a7163d31da80"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">mypy</span></span></h2><div id="https://www.notion.so/bbafbcba05c6499b9cb60a6361abb123" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/python/mypy">mypy</a></span><span class="SemanticString"> 原来是一个兼容大部分 Python 语法的静态类型的 Python 发行版，后来在官方受到启发，并加入类型注解之后，mypy 已经演化成了一个静态类型检查器，我们可以通过 pip 来安装</span></span></p></div><pre id="https://www.notion.so/9461f1b0ff4d4ca0b40162cd86849813" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pip <span class="token function">install</span> mypy</span></span></span></code></pre><div id="https://www.notion.so/a3c5b82923f64365994c05bb6f409e49" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在某些场景下，我们可以通过 mypy 来对项目进行全局扫描</span></span></p></div><pre id="https://www.notion.so/71f1c2d344814aaea01de6e456601dfe" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>➜ mypy some-python-project-path/
foo/utils/sanitizer.py:18: error: Cannot <span class="token function">find</span> module named <span class="token string">'bleach.encoding'</span>
foo/utils/sanitizer.py:19: error: Cannot <span class="token function">find</span> module named <span class="token string">'bleach.sanitizer'</span>
foo/fake/tee/gitlab/client.py:5: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar'</span>
foo/fake/tee/gitlab/client.py:6: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar'</span>
foo/fake/tee/gitlab/client.py:7: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar.objects'</span>
foo/accessories/fake/tags.py:48: error: <span class="token string">"type"</span> has no attribute <span class="token string">"tag_type"</span>
foo/utils/log.py:4: error: Cannot <span class="token function">find</span> module named <span class="token string">'logstash'</span>
foo/utils/log.py:5: error: No library stub <span class="token function">file</span> <span class="token keyword">for</span> module <span class="token string">'redis'</span>
foo/utils/detector.py:32: error: Need <span class="token builtin class-name">type</span> annotation <span class="token keyword">for</span> <span class="token string">'detect_map'</span>
foo/utils/basic.py:3: error: Cannot <span class="token function">find</span> module named <span class="token string">'past.utils'</span>
foo/utils/basic.py:9: error: Cannot <span class="token function">find</span> module named <span class="token string">'bar'</span>
foo/utils/basic.py:10: error: Cannot <span class="token function">find</span> module named <span class="token string">'aenum'</span></span></span></span></code></pre><div id="https://www.notion.so/d89a522a275f4887bdefc2c9a67195b2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在我们项目整体类型注解完善的情况下，可以考虑将 mypy 放到 CI 的流程中。</span></span></p></div><div id="https://www.notion.so/8495dc464f7b48e8b9462207f5cf30bf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">比如 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/tornadoweb/tornado">Tornado</a></span><span class="SemanticString"> 的源码基本已经做到 100% 静态了，扫描整个工程只有两个小问题：</span></span></p></div><pre id="https://www.notion.so/41b298bd282e4473ae352f900639f2da" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>➜ mypy tornado/
tornado/testing.py:263: error: Return <span class="token builtin class-name">type</span> of <span class="token string">"run"</span> incompatible with supertype <span class="token string">"TestCase"</span>
tornado/testing.py:270: error: Incompatible <span class="token builtin class-name">return</span> value <span class="token builtin class-name">type</span> <span class="token punctuation">(</span>got <span class="token string">"Optional[TestResult]"</span>, expected <span class="token string">"TestCase"</span><span class="token punctuation">)</span></span></span></span></code></pre><h2 id="https://www.notion.so/5927d93d74d245b4968d2de327e68d9b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5927d93d74d245b4968d2de327e68d9b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">再让我们看看那个例子</span></span></h2><div id="https://www.notion.so/7f63def2025747f5a242211333e63d5f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下是在 Pycharm 里提示的样子：</span></span></p></div><div id="https://www.notion.so/daa84543885640b99871e7e6df5036fa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/20f06e069613438785086dfb937a433b" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F18f3b568-28f8-4ac2-bd73-be3454394ba8%2FUntitled.png?width=488&amp;table=block&amp;id=20f06e06-9613-4387-8508-6dfb937a433b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F18f3b568-28f8-4ac2-bd73-be3454394ba8%2FUntitled.png?width=488&amp;table=block&amp;id=20f06e06-9613-4387-8508-6dfb937a433b" style="width:488px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/cdbd020f3526468991f9f46bd3285ba9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/76b19b2cfc624842925dc64693b0ed8c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">好了，只要加上了类型注解，那个 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">企图让所有变量都变成元组</strong></span><span class="SemanticString"> 的&quot;元凶&quot;——逗号，就无处遁形了 xD</span></span></p></div><h2 id="https://www.notion.so/f2f4c9b3f9594d6cad103fc288c2f07b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f2f4c9b3f9594d6cad103fc288c2f07b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">结语</span></span></h2><div id="https://www.notion.so/e56ca2da35394b54ab32cc1b2d987fbc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">类型注解给 Python 带来了全新的开发体验，相信此刻的你也有了答案，让 Python “静态” 起来吧。</span></span></p></div><div id="https://www.notion.so/5f55b20b2d2f4be0ace49879fbe31e47" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">参考文档：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/3491f5595e4f462890bf0cacc89f9154" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://dev.to/dstarner/using-pythons-type-annotations-4cfe">Using Python&#x27;s Type Annotations</a></span></span></li><li id="https://www.notion.so/b39773e6a3f5410cae5e99ecc7d702ed" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://realpython.com/python-type-checking/">The Ultimate Guide to Python Type Checking</a></span></span></li><li id="https://www.notion.so/c96d25c4873c40c199fac5a2bdf9fc7b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0483/">PEP 483</a></span></span></li><li id="https://www.notion.so/30d25489b4564fb68e7ecaa184ce263b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a></span></span></li><li id="https://www.notion.so/9d9f22fa42a9417f902c1ca8249c5820" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a></span></span></li><li id="https://www.notion.so/13dc5b7cd51d4ae698d133397584363d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.python.org/zh-cn/3/library/typing.html">typing library</a></span></span></li></ul></article>

  <!-- utterances - Github issue comment -->
  <div>
    <script src="https://utteranc.es/client.js"
      repo="IMBlues/IMBlues.github.io"
      issue-term="pathname"
      label="blog-comment"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>
  </div>
  <!-- utterances - Github issue comment -->

  <footer class="Footer">
  <div>&copy; 布鲁斯鱼的奇思乱想 💭 2019-2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>

</body>

</html>
